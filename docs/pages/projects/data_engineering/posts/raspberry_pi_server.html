<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Chris Kornaros">
<meta name="dcterms.date" content="2024-12-29">

<title>Guide to Setting Up Raspberry Pi for Data Engineering and Virtualization Projects – Chris Kornaros</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../../">
<script src="../../../../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../../../../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-1c9046dab6a82816b581f9a763972ef6.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-4e633b3bb1d7347f2c7ac4c31ef241b7.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../../site_libs/bootstrap/bootstrap-2f104f9dbe6157916333850088cee997.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../../site_libs/bootstrap/bootstrap-dark-b492ac58bfb4d58e36aa8c1fef70243c.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-J1EQMCS7CC"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-J1EQMCS7CC', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"headline",
  "consent_type":"express",
  "palette":"dark",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  ,
"language":"en"
  });
});
</script> 
  


<meta property="og:title" content="Guide to Setting Up Raspberry Pi for Data Engineering and Virtualization Projects – Chris Kornaros">
<meta property="og:description" content="">
<meta property="og:image" content="images/ubuntu-pi-device.png">
<meta property="og:site_name" content="Chris Kornaros">
<meta name="twitter:title" content="Guide to Setting Up Raspberry Pi for Data Engineering and Virtualization Projects – Chris Kornaros">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="images/ubuntu-pi-device.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../../index.html">
    <span class="navbar-title">Chris Kornaros</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../../pages/about/about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-guides" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Guides</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-guides">    
        <li>
    <a class="dropdown-item" href="../../../../pages/guides/guides.html">
 <span class="dropdown-text">Guides</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Projects</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="../../../../pages/projects/projects.html">
 <span class="dropdown-text">Projects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../pages/projects/data_engineering/data_engineering.html">
 <span class="dropdown-text">Data Engineering and Architecture Projects</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../../pages/projects/data_science/data_science.html">
 <span class="dropdown-text">Data Science and Machine Learning Projects</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-blogs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Blogs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-blogs">    
        <li>
    <a class="dropdown-item" href="../../../../pages/blogs/blogs.html">
 <span class="dropdown-text">Blogs</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#sec-introduction" id="toc-sec-introduction" class="nav-link active" data-scroll-target="#sec-introduction">Introduction</a></li>
  <li><a href="#sec-requirements" id="toc-sec-requirements" class="nav-link" data-scroll-target="#sec-requirements">Starting from (<em>close</em>) to Zero</a>
  <ul>
  <li><a href="#hardware-requirements" id="toc-hardware-requirements" class="nav-link" data-scroll-target="#hardware-requirements">Hardware Requirements</a></li>
  <li><a href="#image-requirements" id="toc-image-requirements" class="nav-link" data-scroll-target="#image-requirements">Image requirements</a></li>
  <li><a href="#get-started" id="toc-get-started" class="nav-link" data-scroll-target="#get-started">Get Started</a></li>
  </ul></li>
  <li><a href="#linux-server-basics" id="toc-linux-server-basics" class="nav-link" data-scroll-target="#linux-server-basics">Linux Server Basics</a>
  <ul>
  <li><a href="#first-boot-process" id="toc-first-boot-process" class="nav-link" data-scroll-target="#first-boot-process">First Boot Process</a></li>
  <li><a href="#service-management-with-systemd" id="toc-service-management-with-systemd" class="nav-link" data-scroll-target="#service-management-with-systemd">Service Management with systemd</a></li>
  <li><a href="#understanding-your-home-directory" id="toc-understanding-your-home-directory" class="nav-link" data-scroll-target="#understanding-your-home-directory">Understanding Your Home Directory</a></li>
  <li><a href="#the-root-filesystem" id="toc-the-root-filesystem" class="nav-link" data-scroll-target="#the-root-filesystem">The Root Filesystem</a></li>
  <li><a href="#user-and-group-permissions" id="toc-user-and-group-permissions" class="nav-link" data-scroll-target="#user-and-group-permissions">User and Group Permissions</a>
  <ul class="collapse">
  <li><a href="#basics" id="toc-basics" class="nav-link" data-scroll-target="#basics">Basics</a></li>
  <li><a href="#chmod" id="toc-chmod" class="nav-link" data-scroll-target="#chmod">chmod</a></li>
  <li><a href="#chown" id="toc-chown" class="nav-link" data-scroll-target="#chown">chown</a></li>
  <li><a href="#understanding-permissions" id="toc-understanding-permissions" class="nav-link" data-scroll-target="#understanding-permissions">Understanding Permissions</a></li>
  <li><a href="#advanced-permission-concepts" id="toc-advanced-permission-concepts" class="nav-link" data-scroll-target="#advanced-permission-concepts">Advanced Permission Concepts</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#networking-basics" id="toc-networking-basics" class="nav-link" data-scroll-target="#networking-basics">Networking Basics</a>
  <ul>
  <li><a href="#computer-networking" id="toc-computer-networking" class="nav-link" data-scroll-target="#computer-networking">Computer Networking</a>
  <ul class="collapse">
  <li><a href="#key-terms" id="toc-key-terms" class="nav-link" data-scroll-target="#key-terms">Key Terms</a></li>
  <li><a href="#the-osi-model" id="toc-the-osi-model" class="nav-link" data-scroll-target="#the-osi-model">The OSI Model</a></li>
  <li><a href="#the-tcpip-model" id="toc-the-tcpip-model" class="nav-link" data-scroll-target="#the-tcpip-model">The TCP/IP Model</a></li>
  <li><a href="#network-protocols" id="toc-network-protocols" class="nav-link" data-scroll-target="#network-protocols">Network Protocols</a></li>
  </ul></li>
  <li><a href="#network-connections" id="toc-network-connections" class="nav-link" data-scroll-target="#network-connections">Network Connections</a>
  <ul class="collapse">
  <li><a href="#wired-connections" id="toc-wired-connections" class="nav-link" data-scroll-target="#wired-connections">Wired Connections</a></li>
  <li><a href="#wireless-connections" id="toc-wireless-connections" class="nav-link" data-scroll-target="#wireless-connections">Wireless Connections</a></li>
  <li><a href="#network-interface-names-in-linux" id="toc-network-interface-names-in-linux" class="nav-link" data-scroll-target="#network-interface-names-in-linux">Network Interface Names in Linux</a></li>
  <li><a href="#ip-addressing" id="toc-ip-addressing" class="nav-link" data-scroll-target="#ip-addressing">IP Addressing</a></li>
  </ul></li>
  <li><a href="#ubuntu-server-networking-tools" id="toc-ubuntu-server-networking-tools" class="nav-link" data-scroll-target="#ubuntu-server-networking-tools">Ubuntu Server Networking Tools</a>
  <ul class="collapse">
  <li><a href="#testing-connectivity" id="toc-testing-connectivity" class="nav-link" data-scroll-target="#testing-connectivity">Testing Connectivity</a></li>
  <li><a href="#viewing-network-statistics" id="toc-viewing-network-statistics" class="nav-link" data-scroll-target="#viewing-network-statistics">Viewing Network Statistics</a></li>
  <li><a href="#configuration-files" id="toc-configuration-files" class="nav-link" data-scroll-target="#configuration-files">Configuration Files</a></li>
  </ul></li>
  <li><a href="#systemd-networkd" id="toc-systemd-networkd" class="nav-link" data-scroll-target="#systemd-networkd">systemd-networkd</a>
  <ul class="collapse">
  <li><a href="#basic-wired-configuration" id="toc-basic-wired-configuration" class="nav-link" data-scroll-target="#basic-wired-configuration">Basic Wired Configuration</a></li>
  <li><a href="#dhcp-with-a-wired-connection" id="toc-dhcp-with-a-wired-connection" class="nav-link" data-scroll-target="#dhcp-with-a-wired-connection">DHCP with a Wired Connection</a></li>
  <li><a href="#wireless-configurations-and-wpa_supplicant" id="toc-wireless-configurations-and-wpa_supplicant" class="nav-link" data-scroll-target="#wireless-configurations-and-wpa_supplicant">Wireless Configurations and wpa_supplicant</a></li>
  </ul></li>
  <li><a href="#converting-netplan-to-networkd" id="toc-converting-netplan-to-networkd" class="nav-link" data-scroll-target="#converting-netplan-to-networkd">Converting Netplan to networkd</a>
  <ul class="collapse">
  <li><a href="#step-by-step-migration" id="toc-step-by-step-migration" class="nav-link" data-scroll-target="#step-by-step-migration">Step-by-step Migration</a></li>
  <li><a href="#troubleshooting" id="toc-troubleshooting" class="nav-link" data-scroll-target="#troubleshooting">Troubleshooting</a></li>
  </ul></li>
  <li><a href="#advanced-networking" id="toc-advanced-networking" class="nav-link" data-scroll-target="#advanced-networking">Advanced Networking</a>
  <ul class="collapse">
  <li><a href="#subnets" id="toc-subnets" class="nav-link" data-scroll-target="#subnets">Subnets</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-ssh" id="toc-sec-ssh" class="nav-link" data-scroll-target="#sec-ssh">SSH</a>
  <ul>
  <li><a href="#understanding-ssh-configuration-files" id="toc-understanding-ssh-configuration-files" class="nav-link" data-scroll-target="#understanding-ssh-configuration-files">Understanding SSH Configuration Files</a>
  <ul class="collapse">
  <li><a href="#ssh-client-vs-server-configuration" id="toc-ssh-client-vs-server-configuration" class="nav-link" data-scroll-target="#ssh-client-vs-server-configuration">SSH Client vs Server Configuration</a></li>
  </ul></li>
  <li><a href="#key-based-authentication-setup" id="toc-key-based-authentication-setup" class="nav-link" data-scroll-target="#key-based-authentication-setup">Key-Based Authentication Setup</a>
  <ul class="collapse">
  <li><a href="#understanding-ssh-keys-and-security" id="toc-understanding-ssh-keys-and-security" class="nav-link" data-scroll-target="#understanding-ssh-keys-and-security">Understanding SSH Keys and Security</a></li>
  <li><a href="#generating-your-ssh-keys" id="toc-generating-your-ssh-keys" class="nav-link" data-scroll-target="#generating-your-ssh-keys">Generating Your SSH Keys</a></li>
  <li><a href="#installing-your-public-key-on-the-raspberry-pi" id="toc-installing-your-public-key-on-the-raspberry-pi" class="nav-link" data-scroll-target="#installing-your-public-key-on-the-raspberry-pi">Installing Your Public Key on the Raspberry Pi</a></li>
  </ul></li>
  <li><a href="#server-side-ssh-configuration" id="toc-server-side-ssh-configuration" class="nav-link" data-scroll-target="#server-side-ssh-configuration">Server-Side SSH Configuration</a>
  <ul class="collapse">
  <li><a href="#understanding-server-host-keys" id="toc-understanding-server-host-keys" class="nav-link" data-scroll-target="#understanding-server-host-keys">Understanding Server Host Keys</a></li>
  <li><a href="#optimizing-server-security" id="toc-optimizing-server-security" class="nav-link" data-scroll-target="#optimizing-server-security">Optimizing Server Security</a></li>
  </ul></li>
  <li><a href="#client-side-configuration" id="toc-client-side-configuration" class="nav-link" data-scroll-target="#client-side-configuration">Client-Side Configuration</a>
  <ul class="collapse">
  <li><a href="#setting-up-your-ssh-config" id="toc-setting-up-your-ssh-config" class="nav-link" data-scroll-target="#setting-up-your-ssh-config">Setting Up Your SSH Config</a></li>
  <li><a href="#managing-known-hosts" id="toc-managing-known-hosts" class="nav-link" data-scroll-target="#managing-known-hosts">Managing Known Hosts</a></li>
  <li><a href="#securing-the-key-file" id="toc-securing-the-key-file" class="nav-link" data-scroll-target="#securing-the-key-file">Securing the Key File</a></li>
  </ul></li>
  <li><a href="#additional-security-measures" id="toc-additional-security-measures" class="nav-link" data-scroll-target="#additional-security-measures">Additional Security Measures</a>
  <ul class="collapse">
  <li><a href="#firewall-configuration-with-ufw" id="toc-firewall-configuration-with-ufw" class="nav-link" data-scroll-target="#firewall-configuration-with-ufw">Firewall Configuration with ufw</a></li>
  <li><a href="#fail2ban" id="toc-fail2ban" class="nav-link" data-scroll-target="#fail2ban">Fail2Ban</a></li>
  </ul></li>
  <li><a href="#system-updates" id="toc-system-updates" class="nav-link" data-scroll-target="#system-updates">System Updates</a></li>
  <li><a href="#monitoring-and-maintenance" id="toc-monitoring-and-maintenance" class="nav-link" data-scroll-target="#monitoring-and-maintenance">Monitoring and Maintenance</a>
  <ul class="collapse">
  <li><a href="#regular-security-checks" id="toc-regular-security-checks" class="nav-link" data-scroll-target="#regular-security-checks">Regular Security Checks</a></li>
  <li><a href="#key-management-best-practices" id="toc-key-management-best-practices" class="nav-link" data-scroll-target="#key-management-best-practices">Key Management Best Practices</a></li>
  </ul></li>
  <li><a href="#troubleshooting-1" id="toc-troubleshooting-1" class="nav-link" data-scroll-target="#troubleshooting-1">Troubleshooting</a></li>
  <li><a href="#scp-secure-copy-protocol-and-rsync-remote-sync" id="toc-scp-secure-copy-protocol-and-rsync-remote-sync" class="nav-link" data-scroll-target="#scp-secure-copy-protocol-and-rsync-remote-sync">SCP (Secure Copy Protocol) and rsync (Remote Sync)</a>
  <ul class="collapse">
  <li><a href="#ensuring-your-ssh-configuration-works" id="toc-ensuring-your-ssh-configuration-works" class="nav-link" data-scroll-target="#ensuring-your-ssh-configuration-works">Ensuring Your SSH Configuration Works</a></li>
  <li><a href="#copying-individual-files-from-server-to-client" id="toc-copying-individual-files-from-server-to-client" class="nav-link" data-scroll-target="#copying-individual-files-from-server-to-client">Copying Individual Files from Server to Client</a></li>
  <li><a href="#copying-multiple-files-at-once" id="toc-copying-multiple-files-at-once" class="nav-link" data-scroll-target="#copying-multiple-files-at-once">Copying Multiple Files at Once</a></li>
  <li><a href="#recursively-copying-directories" id="toc-recursively-copying-directories" class="nav-link" data-scroll-target="#recursively-copying-directories">Recursively Copying Directories</a></li>
  <li><a href="#copying-files-from-client-to-server" id="toc-copying-files-from-client-to-server" class="nav-link" data-scroll-target="#copying-files-from-client-to-server">Copying Files from Client to Server</a></li>
  <li><a href="#transferring-files-with-rsync" id="toc-transferring-files-with-rsync" class="nav-link" data-scroll-target="#transferring-files-with-rsync">Transferring Files with rsync</a></li>
  <li><a href="#syncing-directories-with-rsync" id="toc-syncing-directories-with-rsync" class="nav-link" data-scroll-target="#syncing-directories-with-rsync">Syncing Directories with rsync</a></li>
  <li><a href="#syncing-in-reverse-client-to-server" id="toc-syncing-in-reverse-client-to-server" class="nav-link" data-scroll-target="#syncing-in-reverse-client-to-server">Syncing in Reverse (Client to Server)</a></li>
  <li><a href="#using-rsync-with-dry-run" id="toc-using-rsync-with-dry-run" class="nav-link" data-scroll-target="#using-rsync-with-dry-run">Using rsync with Dry Run</a></li>
  <li><a href="#incremental-backups-with-rsync" id="toc-incremental-backups-with-rsync" class="nav-link" data-scroll-target="#incremental-backups-with-rsync">Incremental Backups with rsync</a></li>
  <li><a href="#advanced-rsync-examples" id="toc-advanced-rsync-examples" class="nav-link" data-scroll-target="#advanced-rsync-examples">Advanced rsync Examples</a></li>
  <li><a href="#excluding-files-or-directories" id="toc-excluding-files-or-directories" class="nav-link" data-scroll-target="#excluding-files-or-directories">Excluding Files or Directories</a></li>
  <li><a href="#setting-bandwidth-limits" id="toc-setting-bandwidth-limits" class="nav-link" data-scroll-target="#setting-bandwidth-limits">Setting Bandwidth Limits</a></li>
  <li><a href="#preserving-hard-links" id="toc-preserving-hard-links" class="nav-link" data-scroll-target="#preserving-hard-links">Preserving Hard Links</a></li>
  <li><a href="#choosing-between-scp-and-rsync" id="toc-choosing-between-scp-and-rsync" class="nav-link" data-scroll-target="#choosing-between-scp-and-rsync">Choosing Between SCP and rsync</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#partitions" id="toc-partitions" class="nav-link" data-scroll-target="#partitions">Partitions</a>
  <ul>
  <li><a href="#partitioning-basics" id="toc-partitioning-basics" class="nav-link" data-scroll-target="#partitioning-basics">Partitioning Basics</a></li>
  <li><a href="#partitioning-tools" id="toc-partitioning-tools" class="nav-link" data-scroll-target="#partitioning-tools">Partitioning Tools</a></li>
  <li><a href="#partitioning-a-microsd-card-for-backups" id="toc-partitioning-a-microsd-card-for-backups" class="nav-link" data-scroll-target="#partitioning-a-microsd-card-for-backups">Partitioning a MicroSD Card for Backups</a></li>
  <li><a href="#partitioning-your-ssd" id="toc-partitioning-your-ssd" class="nav-link" data-scroll-target="#partitioning-your-ssd">Partitioning your SSD</a>
  <ul class="collapse">
  <li><a href="#advanced-partitioning" id="toc-advanced-partitioning" class="nav-link" data-scroll-target="#advanced-partitioning">Advanced Partitioning</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#backups-and-basic-automation" id="toc-backups-and-basic-automation" class="nav-link" data-scroll-target="#backups-and-basic-automation">Backups and Basic Automation</a>
  <ul>
  <li><a href="#setting-up-the-backup-directory" id="toc-setting-up-the-backup-directory" class="nav-link" data-scroll-target="#setting-up-the-backup-directory">Setting Up the Backup Directory</a></li>
  <li><a href="#configuration-files-backup" id="toc-configuration-files-backup" class="nav-link" data-scroll-target="#configuration-files-backup">Configuration Files Backup</a></li>
  <li><a href="#system-files-backup" id="toc-system-files-backup" class="nav-link" data-scroll-target="#system-files-backup">System Files Backup</a></li>
  <li><a href="#understanding-the-rsync-options" id="toc-understanding-the-rsync-options" class="nav-link" data-scroll-target="#understanding-the-rsync-options">Understanding the rsync Options</a></li>
  <li><a href="#storing-your-backups-externally" id="toc-storing-your-backups-externally" class="nav-link" data-scroll-target="#storing-your-backups-externally">Storing your backups externally</a>
  <ul class="collapse">
  <li><a href="#rsync-for-remote-transfers" id="toc-rsync-for-remote-transfers" class="nav-link" data-scroll-target="#rsync-for-remote-transfers">Rsync for Remote Transfers</a></li>
  <li><a href="#hardware-transfers" id="toc-hardware-transfers" class="nav-link" data-scroll-target="#hardware-transfers">Hardware Transfers</a></li>
  </ul></li>
  <li><a href="#note" id="toc-note" class="nav-link" data-scroll-target="#note"><strong>Note:</strong></a></li>
  <li><a href="#restoring-from-backup" id="toc-restoring-from-backup" class="nav-link" data-scroll-target="#restoring-from-backup">Restoring from Backup</a></li>
  <li><a href="#important-notes" id="toc-important-notes" class="nav-link" data-scroll-target="#important-notes">Important Notes</a></li>
  <li><a href="#automating-the-backup" id="toc-automating-the-backup" class="nav-link" data-scroll-target="#automating-the-backup">Automating the Backup</a></li>
  <li><a href="#troubleshooting-2" id="toc-troubleshooting-2" class="nav-link" data-scroll-target="#troubleshooting-2">Troubleshooting</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ChrisKornaros/ChrisKornaros.github.io/blob/main/pages/projects/data_engineering/posts/raspberry_pi_server.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/ChrisKornaros/ChrisKornaros.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Guide to Setting Up Raspberry Pi for Data Engineering and Virtualization Projects</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Research</div>
    <div class="quarto-category">Ongoing</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Chris Kornaros </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 29, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="sec-introduction" class="level2">
<h2 class="anchored" data-anchor-id="sec-introduction">Introduction</h2>
<p>This guide provides step-by-step instructions and explanations for configuring a Raspberry Pi 4 to learn about hardware, servers, containerization, and self-hosting principles. <strong>To be clear,</strong> this guide is not-exhaustive and I’m sure there were areas I made mistakes or misunderstood a topic. I’m inviting (encouraging) you to let me know! You can submit an issue via GitHub on the guide on my <a href="https://chriskornaros.github.io/pages/projects/data_engineering/posts/raspberry_pi_server.html">website</a>. That being said, the primary purpose of this guide is so that I can go back and reference what I previously did, as well as understand the thought process, when I need to troubleshoot or recreate something. The secondary purpose is to provide a helpful resource for others in a similar situation to me, because I struggled to find the sort of comprehensive document I’m aiming to create.</p>
<p>Back to this guide, eventually I’d like to setup an actual server cluster and self-host some interesting, more resource-intensive applications. Before I make that kind of commitment, I wanted to learn the basics and see if this is something I would enjoy– the good news, I learned I do. The great news, Raspberry Pi makes their hardware very affordable and easy to purchase. Here’s the official webpage for the exact computer I <a href="https://www.pishop.us/product/raspberry-pi-4-model-b-8gb/?searchid=0&amp;search_query=Raspberry+Pi+4">bought</a>.</p>
<p>It’s worth adding, I bought the 8GB Raspberry Pi 4. The price difference isn’t that great, but the performance is between the lesser 2GB and 4GB models. Additionally, because I’m planning to host and experiment with CI/CD, I also bought a case and cooling fan to help with longevity. All in, the base price for that (with the power supply and HDMI cable) is $107.30 before taxes, shipping, and other fees.</p>
</section>
<section id="sec-requirements" class="level2">
<h2 class="anchored" data-anchor-id="sec-requirements">Starting from (<em>close</em>) to Zero</h2>
<section id="hardware-requirements" class="level3">
<h3 class="anchored" data-anchor-id="hardware-requirements">Hardware Requirements</h3>
<p>This section will provide basic setup instructions, so you’ll have the same tools I do and can follow along with this guide, step-by-step.</p>
<ul>
<li>Raspberry Pi 4 8GB</li>
<li>Micro HDMI to HDMI cord (for direct access)</li>
<li>Appropriate Power Supply</li>
<li>Keyboard (connected via USB for direct access)</li>
<li>1TB Samsung T7 SSD (connected via USB for boot media/core memory)</li>
<li>Amazon Basics 128GB microSD card (or other microSD cards for backups media)</li>
<li>SSH-capable devices for headless access
<ul>
<li>I’m using a MacBook Air</li>
<li>I prefer the MacOS and Terminal for personal development, because I use Windows at my day job</li>
</ul></li>
</ul>
</section>
<section id="image-requirements" class="level3">
<h3 class="anchored" data-anchor-id="image-requirements">Image requirements</h3>
<p>Once you have your hardware ready to go, you can being setting up the software. I’m using Linux Server LTS because it’s a stable version of Linux intended for headless, server environments. LTS means <strong><em>long-term support</em></strong>, so unlike the more frequently updated versions, these OS versions are supported for 5 years. Additionally, you’ll want to use <strong><em>public-key authentication</em></strong> for better security purposes, but more on that in the <a href="@sec-ssh">SSH Section</a>.</p>
<ol type="1">
<li><p>Have your SSD ready and able to connect to either a laptop or desktop (whichever you plan to use with SSH)</p></li>
<li><p>Download Raspberry Pi Imager from the official <a href="https://www.raspberrypi.com/software/">website</a></p></li>
<li><p>Run the Imager and configure your installation of the most recent Linux Server LTS image</p>
<ol type="1">
<li><strong>Select your Raspberry Pi device</strong></li>
</ol>
<p><img src="images/ubuntu-pi-device.png" class="img-fluid"></p>
<ol start="2" type="1">
<li><strong>Select the OS Image you want to flash</strong></li>
</ol>
<p><img src="images/ubuntu-pi-os.png" class="img-fluid"></p>
<ol start="3" type="1">
<li><strong>Select the media storage device for the image</strong></li>
</ol>
<p><img src="images/ubuntu-pi-storage.png" class="img-fluid"></p>
<ol start="4" type="1">
<li><strong>Configure settings</strong></li>
</ol>
<p><img src="images/ubuntu-pi-config-general.png" class="img-fluid"> Here, you’ll configure your primary user ID and password; network connection; locale and timezone; and your hostname (the nickname your computer remembers the IP address as).</p>
<p><img src="images/ubuntu-pi-config-service.png" class="img-fluid"> Here, you’ll configure your SSH settings. You should probably use <strong><em>public-key authentication</em></strong> only when dealing with SSH in your leave, but for learning purposes, you don’t need to at this time. Later on in this guide, I’ll walk you through the steps to manually configure SSH, if you are unfamiliar.</p>
<p><img src="images/ubuntu-pi-config-options.png" class="img-fluid"> These are more preference based, but it’s nice to have the storage device automatically eject once the flashing is complete. Then, you just need to unplug it and plug it into your Raspberry Pi to get going.</p></li>
</ol>
</section>
<section id="get-started" class="level3">
<h3 class="anchored" data-anchor-id="get-started">Get Started</h3>
<p>Now you’re ready to plug your boot media device (the SSD) into your Raspberry Pi. You should also connect a keyboard, monitor, and power supply. Once all of this is connected, your Raspberry Pi will boot up. Connecting a monitor and keyboard will allow you to directly interact with the system’s terminal. Ideally, you’ll use SSH, but it may be helpful to have direct access in case there are any network issues.</p>
<p>When first connecting from the wired keyboard and monitor, let all of the start up processes finish running (these will <em>hopefully</em> have brackets with the word <code>Success</code> in green). Then, type in the name of the User ID you wish to login with, in my case it’s <code>chris</code>. Then, enter the password (no characters will show up as you type it in) and hit enter. You’ll see a plaintext message telling you the OS version, some system information (memory usage, temperature, etc.), and you’ll see a line where you can enter commands (the CLI). In my case, it looks like this: <code>chris@ubuntu-pi-server:~$</code></p>
<p>Now you can run some basic commands to see where you are and what you have available to you. Spoiler alert, you’re in your home directory and have no files. In my case it’s <code>/home/chris</code>, where the <code>/home</code> directory is owned by <em>root</em> and <code>/chris</code> is owned by my user– UID 1000 (the default for new users on a fresh system/image). Right now your directory will be empty, outside of some hidden folders like <code>.ssh</code>. More on this later.</p>
<p>Next we’ll cover what happened during the boot process, the basic structure of the Linux Server OS, and some important information related to permissions, before we move on to basic networking concepts and configurations.</p>
</section>
</section>
<section id="linux-server-basics" class="level2">
<h2 class="anchored" data-anchor-id="linux-server-basics">Linux Server Basics</h2>
<section id="first-boot-process" class="level3">
<h3 class="anchored" data-anchor-id="first-boot-process">First Boot Process</h3>
<p>When you first boot a fresh Ubuntu Server LTS image on your Raspberry Pi, several important initialization processes occur that don’t happen during subsequent boots. The first boot of your Ubuntu Server LTS on the Raspberry Pi is fundamentally different from subsequent boots because it performs one-time initialization tasks. While later boots will simply load the configured system, this first boot sets up critical system components.</p>
<ul>
<li><strong>Hardware Detection:</strong> The system performs comprehensive hardware detection to identify and configure your Raspberry Pi’s components.</li>
<li><strong>Initial RAM Disk (initrd):</strong> The bootloader loads a temporary filesystem into memory that contains essential drivers and modules needed to mount the real root filesystem.</li>
<li><strong>Filesystem Check and Expansion:</strong> On first boot, the system checks the integrity of the filesystem and often expands it to utilize the full available space on your SSD.</li>
<li><strong>Cloud-Init Processing:</strong> Ubuntu Server uses cloud-init to perform first-boot configuration tasks (the processes you see running on the monitor on startup)
<ul>
<li>Setting the hostname</li>
<li>Generating SSH host keys</li>
<li>Creating the default user account</li>
<li>Running package updates</li>
</ul></li>
<li><strong>Machine ID Generation:</strong> A unique machine ID is generated and stored in /etc/machine-id.</li>
<li><strong>Network Configuration:</strong> The system attempts initial network setup based on detected hardware.</li>
</ul>
<p>The key difference is that subsequent boots skip these initialization steps since they’ve already been completed, making them significantly faster.</p>
</section>
<section id="service-management-with-systemd" class="level3">
<h3 class="anchored" data-anchor-id="service-management-with-systemd">Service Management with systemd</h3>
<p>Systemd is the modern initialization and service management system for Linux. It’s responsible for bootstrapping the user space and managing all processes afterward. Key components of systemd include:</p>
<ul>
<li><strong>Units:</strong> Everything systemd manages is represented as a “unit” with a corresponding configuration file. Units include:
<ul>
<li><strong>Service units (<code>.service</code>):</strong> Define how to start, stop, and manage daemons</li>
<li><strong>Socket units (<code>.socket</code>):</strong> Manage network/IPC sockets</li>
<li><strong>Timer units (<code>.timer</code>):</strong> Trigger other units based on timers</li>
<li><strong>Mount units (<code>.mount</code>):</strong> Control filesystem mount points</li>
</ul></li>
<li><strong>Target units:</strong> Represent system states (similar to runlevels in older systems)
<ul>
<li><code>multi-user.target</code>: Traditional text-mode system</li>
<li><code>graphical.target</code>: Graphical user interface</li>
<li><code>network.target</code>: Network services are ready</li>
</ul></li>
</ul>
<p>For example, let’s take a look at a generic SSH service file.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">[Unit]</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Description</span><span class="ot">=</span><span class="st">OpenSSH server daemon</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Documentation</span><span class="ot">=</span><span class="st">man:sshd(8) man:sshd_config(5)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">After</span><span class="ot">=</span><span class="st">network.target auditd.service</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">Wants</span><span class="ot">=</span><span class="st">network.target</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">[Service]</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="dt">EnvironmentFile</span><span class="ot">=</span><span class="st">-/etc/default/ssh</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dt">ExecStartPre</span><span class="ot">=</span><span class="st">/usr/sbin/sshd -t</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="dt">ExecStart</span><span class="ot">=</span><span class="st">/usr/sbin/sshd -D $SSHD_OPTS</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="dt">ExecReload</span><span class="ot">=</span><span class="st">/usr/sbin/sshd -t</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="dt">ExecReload</span><span class="ot">=</span><span class="st">/bin/kill -HUP $MAINPID</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="dt">KillMode</span><span class="ot">=</span><span class="st">process</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="dt">Restart</span><span class="ot">=</span><span class="st">on-failure</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="dt">RestartPreventExitStatus</span><span class="ot">=</span><span class="dv">255</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="dt">Type</span><span class="ot">=</span><span class="st">notify</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="kw">[Install]</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="dt">WantedBy</span><span class="ot">=</span><span class="st">multi-user.target</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To break this down:</p>
<ul>
<li><strong>[Unit]:</strong> Metadata and dependencies
<ul>
<li><code>Description</code>: Human-readable service description</li>
<li><code>Documentation</code>: Where to find documentation</li>
<li><code>After</code>: Units that should be started before this one</li>
<li><code>Wants</code>: Soft dependencies</li>
</ul></li>
<li><strong>[Service]:</strong> Runtime behavior
<ul>
<li><code>ExecStart</code>: Command to start the service</li>
<li><code>ExecReload</code>: Command to reload the service</li>
<li><code>Restart</code>: When to restart the service</li>
<li><code>Type</code>: How systemd should consider the service started</li>
</ul></li>
<li><strong>[Install]:</strong> Installation information
<ul>
<li><code>WantedBy</code>: Target that should include this service</li>
</ul></li>
</ul>
<p>Ubuntu Server’s current standard is <code>systemd</code>, but previously it was <code>SysV</code>. A few key improvements include:</p>
<ul>
<li><strong>Parallel Service Startup:</strong> Systemd can start services in parallel, improving boot times.</li>
<li><strong>Dependency Management:</strong> Systemd handles service dependencies more effectively.</li>
<li><strong>Service Supervision:</strong> Systemd continuously monitors and can automatically restart services.</li>
<li><strong>Socket Activation:</strong> Services can be started on-demand when a connection request arrives.</li>
</ul>
<p>Managing services is easy using the command line, a crucial component of headless applications, a few examples are:</p>
<ul>
<li><strong>View service status:</strong> <code>systemctl status ssh</code></li>
<li><strong>Start a service:</strong> <code>sudo systemctl start ssh</code></li>
<li><strong>Stop a service:</strong> <code>sudo systemctl stop ssh</code></li>
<li><strong>Enable at boot:</strong> <code>sudo systemctl enable ssh</code></li>
<li><strong>Disable at boot:</strong> <code>sudo systemctl disable ssh</code></li>
<li><strong>View logs:</strong> <code>journalctl -u ssh</code></li>
</ul>
</section>
<section id="understanding-your-home-directory" class="level3">
<h3 class="anchored" data-anchor-id="understanding-your-home-directory">Understanding Your Home Directory</h3>
<p>Now that you’ve logged in and can work on your server, you may wonder where you are and what’s there. Running <code>pwd</code> will return the file path of your current location. Running <code>ls -a</code> will show you all available files and directories in your current location. Running these, you’ll see a few things specifically for Shell configuration (your terminal/CLI):</p>
<ul>
<li><code>.bash_history</code>: Contains a record of commands you’ve executed in the bash shell. This helps with command recall using the up arrow or history command.</li>
<li><code>.bash_logout</code>: Executed when you log out of a bash shell. Often used for cleanup tasks like clearing the screen.</li>
<li><code>.bashrc</code>: The primary bash configuration file that’s loaded for interactive non-login shells. It defines aliases, functions, and shell behavior. When you open a terminal window, this file is read.</li>
<li><code>.profile</code>: Executed for login shells. It typically sets environment variables and executes commands that should run once per login session, not for each new terminal.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample .bashrc section</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># enable color support of ls and also add handy aliases</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-x</span> /usr/bin/dircolors <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">test</span> <span class="at">-r</span> ~/.dircolors <span class="kw">&amp;&amp;</span> <span class="bu">eval</span> <span class="st">"</span><span class="va">$(</span><span class="fu">dircolors</span> <span class="at">-b</span> ~/.dircolors<span class="va">)</span><span class="st">"</span> <span class="kw">||</span> <span class="bu">eval</span> <span class="st">"</span><span class="va">$(</span><span class="fu">dircolors</span> <span class="at">-b</span><span class="va">)</span><span class="st">"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">alias</span> ls=<span class="st">'ls --color=auto'</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">alias</span> grep=<span class="st">'grep --color=auto'</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">alias</span> fgrep=<span class="st">'fgrep --color=auto'</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">alias</span> egrep=<span class="st">'egrep --color=auto'</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co"># some more ls aliases</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> ll=<span class="st">'ls -alF'</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> la=<span class="st">'ls -A'</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> l=<span class="st">'ls -CF'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Beyond those, you’ll also find hidden application directories.</p>
<ul>
<li><code>.cache</code>: Contains non-essential data that can be regenerated as needed. Applications store temporary files here to improve performance on subsequent runs.</li>
<li><code>.dotnet</code>: Contains .NET Core SDK and runtime files if you’ve installed the .NET development platform.</li>
<li><code>.ssh</code>: Stores SSH configuration files and keys:
<ul>
<li><code>authorized_keys</code>: Lists public keys that can authenticate to your account</li>
<li><code>id_ecdsa</code> &amp; <code>id_ecdsa.pub</code>: Your private and public ECDSA keys (More on this in the <a href="@sec-ssh">SSH Section</a>)</li>
<li><code>known_hosts</code>: Tracks hosts you’ve connected to previously</li>
<li><code>ssh_config</code>: Optional configuration file for SSH connections</li>
</ul></li>
<li><code>.sudo_as_admin_successful</code>: A marker file created when you successfully use sudo. Its presence suppresses the “sudo capabilities” message when opening a terminal.</li>
<li><code>.vscode-server</code>: Created when you connect to your server using Visual Studio Code’s remote development feature. Contains the VS Code server components. (More on this in the <a href="@sec-ssh">SSH Section</a>)</li>
<li><code>.wget-hsts</code>: Wget’s HTTP Strict Transport Security database. Tracks websites that require secure (HTTPS) connections.</li>
</ul>
</section>
<section id="the-root-filesystem" class="level3">
<h3 class="anchored" data-anchor-id="the-root-filesystem">The Root Filesystem</h3>
<p>The Linux filesystem follows the Filesystem Hierarchy Standard (FHS), which defines the directory structure and contents of Unix-like systems. Here’s a breakdown of key directories:</p>
<ul>
<li><code>/bin</code>: Contains essential command binaries (programs) needed for basic system functionality. These commands are available to all users and are required during boot or in single-user mode.
<ul>
<li>Historical note: Originally separated from /usr/bin because early Unix systems had limited disk space on the root partition.</li>
</ul></li>
<li><code>/boot</code>: Contains boot loader files including the Linux kernel, initial RAM disk (initrd), and bootloader configuration (<strong>GRUB</strong>).
<ul>
<li>For Raspberry Pi, this contains the firmware and various boot-related files.</li>
</ul></li>
<li><code>/dev</code>: Contains device files that represent hardware devices. These are not actual files but interfaces to device drivers in the kernel.
<ul>
<li><strong>Example:</strong> /dev/sda represents the first SATA disk.</li>
</ul></li>
<li><code>/etc</code>: Contains system-wide configuration files. The name originated from “et cetera” but is now often interpreted as “Editable Text Configuration.” Critical files include:
<ul>
<li><code>/etc/fstab</code>: Filesystem mount configuration</li>
<li><code>/etc/passwd</code>: User account information</li>
<li><code>/etc/ssh/sshd_config</code>: SSH server configuration</li>
</ul></li>
<li><code>/home</code>: Contains user home directories where personal files and user-specific configuration files are stored.</li>
<li><code>/lib</code>: Contains essential shared libraries needed by programs in /bin and system boot.
<ul>
<li>On modern 64-bit systems, you’ll also find /lib64 for 64-bit libraries.</li>
</ul></li>
<li><code>/media</code>: Mount point for removable media like USB drives and DVDs.</li>
<li><code>/mnt</code>: Temporarily mounted filesystems. This is often used as a manual mount point.</li>
<li><code>/opt</code>: Optional application software packages. Used for third-party applications that don’t follow the standard file system layout.</li>
<li><code>/proc</code>: A virtual filesystem providing process and kernel information. Files here don’t exist on disk but represent system state.
<ul>
<li><strong>Example:</strong> /proc/cpuinfo shows CPU information.</li>
</ul></li>
<li><code>/root</code>: Home directory for the root user. Separated from /home to ensure it’s available even if /home is on a separate partition.</li>
<li><code>/run</code>: Runtime data for processes started since last boot. This is a tmpfs (memory-based) filesystem.</li>
<li><code>/sbin</code>: System binaries for system administration tasks, typically only usable by the root user.</li>
<li><code>/srv</code>: Data for services provided by the system, such as web or FTP servers.</li>
<li><code>/snap</code>: The /snap directory is, by default, where the files and folders from installed snap packages appear on your system.</li>
<li><code>/sys</code>: Another virtual filesystem exposing device and driver information from the kernel. Provides a more structured view than /proc.</li>
<li><code>/tmp</code>: Temporary files that may be cleared on reboot. Applications should not rely on data here persisting.</li>
<li><code>/usr</code>: Contains the majority of user utilities and applications. Originally stood for “Unix System Resources.”
<ul>
<li><code>/usr/bin</code>: User commands</li>
<li><code>/usr/lib</code>: Libraries for the commands in /usr/bin</li>
<li><code>/usr/local</code>: Locally installed software</li>
<li><code>/usr/share</code>: Architecture-independent data</li>
</ul></li>
<li><code>/var</code>: Variable data files that change during normal operation:
<ul>
<li><code>/var/log</code>: System log files</li>
<li><code>/var/mail</code>: Mail spool</li>
<li><code>/var/cache</code>: Application cache data</li>
<li><code>/var/spool</code>: Spool for tasks waiting to be processed (print queues, outgoing mail)</li>
</ul></li>
</ul>
<p>The core philosophy behind this structure separates:</p>
<ul>
<li>Static vs.&nbsp;variable content</li>
<li>Shareable vs.&nbsp;non-shareable files</li>
<li>Essential vs.&nbsp;non-essential components</li>
</ul>
<p>Understanding this hierarchy helps you navigate any Linux system and locate important files intuitively.</p>
</section>
<section id="user-and-group-permissions" class="level3">
<h3 class="anchored" data-anchor-id="user-and-group-permissions">User and Group Permissions</h3>
<section id="basics" class="level4">
<h4 class="anchored" data-anchor-id="basics">Basics</h4>
<p>Linux inherits its permission system from Unix, providing a robust framework for controlling access to files and directories. Understanding this system is essential for maintaining security and proper functionality of your Raspberry Pi server, as well as any Linux based system. At its core, the Linux permission model operates with three basic permission types applied to three different categories of users:</p>
<ul>
<li><strong>Permission Types:</strong>
<ul>
<li><strong>Read (r):</strong> Allows viewing file contents or listing directory contents</li>
<li><strong>Write (w):</strong> Allows modifying file contents or creating/deleting files within a directory</li>
<li><strong>Execute (x):</strong> Allows running a file as a program or accessing files within a directory</li>
</ul></li>
<li><strong>User Categories:</strong>
<ul>
<li><strong>Owner (u):</strong> The user who owns the file or directory</li>
<li><strong>Group (g):</strong> Users who belong to the file’s assigned group</li>
<li><strong>Others (o):</strong> All other users on the system</li>
</ul></li>
</ul>
<p>It’s not only important to know how to set permissions, but also how to view existing ones. When you run ls -l in a directory, you’ll see a detailed listing including permission information.</p>
<pre class="plaintext"><code>-rw-r--r-- 1 chris chris 1234 May 6 14:32 example.txt</code></pre>
<p>In this example, the owner can read and write, while group members and others can only read. The first string of characters -rw-r–r– represents the permissions:</p>
<ul>
<li><strong>First character:</strong> File type (- for regular file, d for directory, l for symbolic link)</li>
<li><strong>Characters 2-4:</strong> Owner permissions (rw-)</li>
<li><strong>Characters 5-7:</strong> Group permissions (r–)</li>
<li><strong>Characters 8-10:</strong> Others permissions (r–)</li>
</ul>
</section>
<section id="chmod" class="level4">
<h4 class="anchored" data-anchor-id="chmod">chmod</h4>
<p>The <code>chmod</code> command modifies file permissions in Linux. You can use it in two ways: symbolic mode or numeric (octal) mode.</p>
<p>Symbolic mode uses letters to represent permission categories (u, g, o, a) and permissions (r, w, x):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Give the owner execute permission</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> u+x script.sh</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove write permission from group and others</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> go-w important_file.txt</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set read and execute for everyone (a=all users)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> a=rx application</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add write permission for owner and group</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> ug+w shared_document.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each symbol has a specific meaning:</p>
<ul>
<li><code>u</code>: Owner permissions</li>
<li><code>g</code>: Group permissions</li>
<li><code>o</code>: Other user permissions</li>
<li><code>a</code>: All permissions</li>
<li><code>+</code>: Add permissions</li>
<li><code>-</code>: Remove permissions</li>
<li><code>=</code>: Set exact permissions</li>
</ul>
<p>Octal mode represents permissions as a 3-digit number, where each digit represents the permissions for owner, group, and others:</p>
<ul>
<li><code>Read (r)</code> = 4</li>
<li><code>Write (w)</code> = 2</li>
<li><code>Execute (x)</code> = 1</li>
</ul>
<p>Permissions are calculated by adding these values:</p>
<ul>
<li><code>7 (4+2+1)</code> = Read, write, and execute</li>
<li><code>6 (4+2)</code> = Read and write</li>
<li><code>5 (4+1)</code> = Read and execute</li>
<li><code>4 (4)</code> = Read only</li>
<li><code>0</code> = No permissions</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rwxr-xr-x (755): Owner can read, write, execute; group and others can read and execute</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 755 script.sh</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># rw-r--r-- (644): Owner can read and write; group and others can read only</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 644 document.txt</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># rwx------ (700): Owner has all permissions; group and others have none</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 700 private_directory</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Beyond the basic rwx permissions, Linux has three special permission bits:</p>
<ul>
<li><code>setuid (4000)</code>: When set on an executable file, it runs with the privileges of the file owner instead of the user executing it.</li>
<li><code>setgid (2000)</code>: Similar to setuid but for group permissions. When set on a directory, new files created within inherit the directory’s group.</li>
<li><code>sticky bit (1000)</code>: When set on a directory, files can only be deleted by their owner, the directory owner, or root (commonly used for /tmp).</li>
</ul>
</section>
<section id="chown" class="level4">
<h4 class="anchored" data-anchor-id="chown">chown</h4>
<p>The <code>chown</code> command changes the owner and/or group of files and directories. Do not change ownership in the root directories because many require specific ownership/permissions to function properly.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the owner of a file</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown chris file.txt</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Change both owner and group</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown chris:developers project_files</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Change only the group</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown :developers shared_documents</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Change recursively for a directory and all its contents</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> chris:chris /home/chris/projects</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The flags do the following:</p>
<ul>
<li><code>-R, --recursive</code>: Change ownership recursively</li>
<li><code>-c, --changes</code>: Report only when a change is made</li>
<li><code>-f, --silent</code>: Suppress most error messages</li>
<li><code>-v, --verbose</code>: Output a diagnostic for every file processed</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verbose recursive ownership change</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-Rv</span> chris:developers /opt/application</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="understanding-permissions" class="level4">
<h4 class="anchored" data-anchor-id="understanding-permissions">Understanding Permissions</h4>
<p>Linux manages permissions through users and groups:</p>
<ul>
<li>Each user has a unique User ID (UID)</li>
<li>Each group has a unique Group ID (GID)</li>
<li>Users can belong to multiple groups</li>
<li>The first 1000 UIDs/GIDs are typically reserved for system users/groups</li>
</ul>
<p><strong>Important files</strong> include:</p>
<ul>
<li><code>/etc/passwd</code>: Contains basic user account information
<ul>
<li><strong>Fields:</strong> username, password placeholder, UID, primary GID, full name, home directory, login shell</li>
</ul></li>
</ul>
<pre class="plaintext"><code>chris:x:1000:1000:Chris Kornaros:/home/chris:/bin/bash</code></pre>
<ul>
<li><code>/etc/shadow</code>: Contains encrypted passwords and password policy information
<ul>
<li><strong>Fields:</strong> username, encrypted password, days since epoch of last change, min days between changes, max days password valid, warning days, inactive days, expiration date</li>
</ul></li>
</ul>
<pre class="plaintext"><code>chris:$6$xyz...hash:19000:0:99999:7:::</code></pre>
<ul>
<li><code>/etc/group</code>: Contains group definitions
<ul>
<li><strong>Fields:</strong> group name, password placeholder, GID, comma-separated list of members</li>
</ul></li>
</ul>
<pre class="plaintext"><code>developers:x:1001:chris,bob,alice</code></pre>
<p>There are two categories of groups you should understand, <strong>Primary</strong> and <strong>Supplementary</strong>:</p>
<ul>
<li><strong>Primary Group:</strong> Set in /etc/passwd, used as the default group for new files</li>
<li><strong>Supplementary Groups:</strong> Additional groups a user belongs to, defined in /etc/group</li>
</ul>
<p>You can view your current user’s groups with the <code>groups</code> command, or view them for a specific user with <code>groups chris</code> (replace <code>chris</code> with the name of the user). That being said, directory permissions differ slightly from file permissions:</p>
<ul>
<li><strong>Read (r):</strong> List directory contents</li>
<li><strong>Write (w):</strong> Create, delete, or rename files within the directory</li>
<li><strong>Execute (x):</strong> Access files within the directory (crucial for navigation)</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>A common confusion:</strong> You may have read permission for a file but not execute permission for its parent directory, preventing access.</p>
</div>
</div>
<p>The umask (user mask) determines the default permissions for newly created files and directories:</p>
<ul>
<li><strong>Default for files:</strong> 666 (rw-rw-rw-)</li>
<li><strong>Default for directories:</strong> 777 (rwxrwxrwx)</li>
<li>The umask is subtracted from these defaults, for example, a umask of 022 results in:
<ul>
<li><strong>Files:</strong> 644 (rw-r–r–)</li>
<li><strong>Directories:</strong> 755 (rwxr-xr-x)</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View current umask (in octal)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">umask</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a new umask</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="bu">umask</span> 027  <span class="co"># More restrictive: owner full access, group read/execute, others no access</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Traditional Unix permissions have limitations regarding inheritance: new files don’t inherit permissions from parent directories and changing permissions doesn’t affect existing files. Modern solutions, however, include: the setgid bit on directories for group inheritance and ACLs (Access Control Lists) with default entries that apply to new files. To setup a collaborative directory with proper permissions:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a shared directory for developers</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir /opt/projects</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown chris:developers /opt/projects</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chmod 2775 /opt/projects  <span class="co"># setgid bit ensures new files get 'developers' group</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="advanced-permission-concepts" class="level4">
<h4 class="anchored" data-anchor-id="advanced-permission-concepts">Advanced Permission Concepts</h4>
<p>Like I previously wrote, part of the modern permission solutions include ACLs, or Access Control Lists. ACLs extend the traditional permission model to allow specifying permissions for multiple users and groups. When ACLs are in use, ls -l will show a + after the permission bits. Here’s a basic example of how to create and manage an ACL:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install ACL support (if not already installed)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install acl</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Set an ACL allowing a specific user read access</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="ex">setfacl</span> <span class="at">-m</span> u:chris:r file.txt</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set an ACL allowing a specific group write access</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="ex">setfacl</span> <span class="at">-m</span> g:developers:rw file.txt</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set default ACLs on a directory (inherited by new files)</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="ex">setfacl</span> <span class="at">-d</span> <span class="at">-m</span> g:developers:rw directory/</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># View ACLs on a file</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="ex">getfacl</span> file.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre class="plaintext"><code>-rw-rw-r--+ 1 chris developers 1234 May 6 14:32 file.txt</code></pre>
<p>A few final notes on permissions that are especially relevant for this project, becaue you’ll be working with external storage devices:</p>
<ul>
<li>Not all filesystems support the same permission features:
<ul>
<li><code>ext4</code>: Full support for traditional permissions, ACLs, and extended attributes</li>
<li><code>NTFS (via NTFS-3G)</code>: Simulated Unix permissions, basic ACL support</li>
<li><code>FAT32</code>: No native permission support (mounted with fixed permissions)</li>
<li><code>exFAT</code>: No native permission support</li>
</ul></li>
<li>Common Permission Patterns:
<ul>
<li><strong>Configuration Files:</strong> 644 or 640 (owner can edit, restricted read access)</li>
<li><strong>Program Binaries:</strong> 755 (everyone can execute, only owner can modify)</li>
<li><strong>Web Content:</strong> 644 for regular files, 755 for directories</li>
<li><strong>SSH Keys:</strong> 600 for private keys (owner only), 644 for public keys</li>
<li><strong>Scripts:</strong> 700 or 750 (executable by owner or group)</li>
</ul></li>
</ul>
</section>
</section>
</section>
<section id="networking-basics" class="level2">
<h2 class="anchored" data-anchor-id="networking-basics">Networking Basics</h2>
<p>This section provides a brief example of how to connect your server to WiFi. It assumes you are already connected using the wireless network settings you configured in the <a href="@sec-requirements">Requirements Section</a>. That being said, I’ll also go over some basic networking concepts and background information. As a result, some of the decisiions and terminology in this guide will make more sense (it also helps me remember what I’m doing and why).</p>
<section id="computer-networking" class="level3">
<h3 class="anchored" data-anchor-id="computer-networking">Computer Networking</h3>
<p>Simply put, a computer network is a collection of interconnected devices that can communicate with each other using a set of rules called protocols. Networking allows devices to share resources, exchange data, and collaborate on tasks. On a deeper level, it helps to understand the conceptual models that describes how data moves through a network. Before we dive in, let’s go over some basic terminology.</p>
<section id="key-terms" class="level4">
<h4 class="anchored" data-anchor-id="key-terms">Key Terms</h4>
<p><strong>Basic Networking Concepts:</strong></p>
<ul>
<li><strong>Protocol:</strong> A set of rules that determine how data is transmitted between devices on a network. Examples include TCP, UDP, and HTTP.</li>
<li><strong>MAC Address:</strong> Media Access Control address; a unique hardware identifier assigned to network interfaces. It’s a 48-bit address (e.g., 00:1A:2B:3C:4D:5E) permanently assigned to a network adapter.</li>
<li><strong>IP Address:</strong> A numerical label assigned to each device on a network that uses the Internet Protocol. Functions like a postal address for devices.</li>
<li><strong>Packet:</strong> A unit of data transmitted over a network. Includes both the data payload and header information for routing.</li>
<li><strong>Subnet:</strong> A logical subdivision of an IP network that allows for more efficient routing and security segmentation.</li>
<li><strong>Gateway:</strong> A network node that serves as an access point to another network, typically connecting a local network to the wider internet.</li>
<li><strong>DNS:</strong> Domain Name System; translates human-readable domain names (like google.com) into IP addresses computers can understand.</li>
<li><strong>DHCP:</strong> Dynamic Host Configuration Protocol; automatically assigns IP addresses and other network configuration parameters to devices.</li>
</ul>
<p><strong>Network Types and Components:</strong></p>
<ul>
<li><strong>LAN:</strong> Local Area Network; a network confined to a small geographic area, like a home or office.</li>
<li><strong>WAN:</strong> Wide Area Network; connects multiple LANs across large geographic distances.</li>
<li><strong>Router:</strong> A device that forwards data packets between computer networks, determining the best path for data transmission.</li>
<li><strong>Switch:</strong> A networking device that connects devices within a single network and uses MAC addresses to forward data to the correct destination.</li>
<li><strong>Bandwidth:</strong> The maximum data transfer rate of a network connection, measured in bits per second (bps).</li>
<li><strong>Latency:</strong> The delay between sending and receiving data, typically measured in milliseconds.</li>
</ul>
<p><strong>Linux Networking Terminology:</strong></p>
<ul>
<li><strong>Interface:</strong> A connection between a device and a network. In Linux, these have names like eth0 (Ethernet) or wlan0 (wireless).</li>
<li><strong>Netplan:</strong> Ubuntu’s default network configuration tool that uses YAML files to define network settings.</li>
<li><strong>systemd-networkd:</strong> A system daemon that manages network configurations in modern Linux distributions.</li>
<li><strong>NetworkManager:</strong> An alternative network management daemon that provides detection and configuration for automatic network connectivity.</li>
<li><strong>Socket:</strong> An endpoint for sending or receiving data across a network, defined by an IP address and port number.</li>
</ul>
<p><strong>Security Concepts:</strong></p>
<ul>
<li><strong>Firewall:</strong> Software or hardware that monitors and filters incoming and outgoing network traffic based on predetermined security rules.</li>
<li><strong>SSH:</strong> Secure Shell; a cryptographic network protocol for secure data communication and remote command execution.</li>
<li><strong>Encryption:</strong> The process of encoding information to prevent unauthorized access.</li>
<li><strong>Port:</strong> A virtual point where network connections start and end. Ports are identified by numbers (0-65535).</li>
<li><strong>NAT:</strong> Network Address Translation; allows multiple devices on a local network to share a single public IP address.</li>
<li><strong>VPN:</strong> Virtual Private Network; extends a private network across a public network, enabling secure data transmission.</li>
</ul>
</section>
<section id="the-osi-model" class="level4">
<h4 class="anchored" data-anchor-id="the-osi-model">The OSI Model</h4>
<p>Now that you understand some common terms and concepts, we can dive into the conceptual models. The <strong><em>Open Systems Interconnection (OSI)</em></strong> Model divides networking into seven layers, each handling specific aspects of network communication.</p>
<ol type="1">
<li><strong>Physical Layer</strong>: Physical medium, electrical signals, cables, and hardware</li>
<li><strong>Data Link Layer</strong>: Physical addressing (MAC addresses), error detection</li>
<li><strong>Network Layer</strong>: Logical addressing (IP addresses), routing</li>
<li><strong>Transport Layer</strong>: End-to-end connections, reliability (TCP/UDP)</li>
<li><strong>Session Layer</strong>: Session establishment, management, and termination</li>
<li><strong>Presentation Layer</strong>: Data translation, encryption, compression</li>
<li><strong>Application Layer</strong>: User interfaces and services (HTTP, SMTP, etc.)</li>
</ol>
</section>
<section id="the-tcpip-model" class="level4">
<h4 class="anchored" data-anchor-id="the-tcpip-model">The TCP/IP Model</h4>
<p>The OSI Model is conceptual, but the <strong><em>TCP/IP Model</em></strong> is more practical and has four layers.</p>
<ol type="1">
<li><strong>Network Access Layer:</strong>Combines OSI’s Physical and Data Link layers</li>
<li><strong>Internet Layer:</strong> Similar to OSI’s Network layer (IP)</li>
<li><strong>Transport Layer:</strong> Same as OSI’s Transport layer (TCP/UDP)</li>
<li><strong>Application Layer:</strong> Combines OSI’s Session, Presentation, and Application layers</li>
</ol>
</section>
<section id="network-protocols" class="level4">
<h4 class="anchored" data-anchor-id="network-protocols">Network Protocols</h4>
<p>Remember, a protocol is a set of rules that determine how data is transmitted between devices on a network. You can think of protocols in one of two camps, <em>Connection-Oriented</em> and <em>Connectionless</em>. Within these camps, two protocols stand out as the backbone of the internet’s data transfers: <strong>TCP</strong> and <strong>UDP</strong>.</p>
<p><strong><em>TCP (Transmission Control Protocol)</em></strong> is a connection-oriented protocol that establishes a dedicated end-to-end connection before transmitting data. TCP is used when reliability is more important than speed (e.g., web browsing, email, file transfers). It has four defining traits:</p>
<ul>
<li><strong>Reliability:</strong> Guarantees delivery of packets in the correct order</li>
<li><strong>Flow Control:</strong> Prevents overwhelming receivers with too much data</li>
<li><strong>Error Detection:</strong> Identifies and retransmits lost or corrupted packets</li>
<li><strong>Handshake Process:</strong> Three-way handshake establishes connections</li>
</ul>
<p><strong><em>UDP (User Datagram Protocol)</em></strong> is a connectionless protocol that sends data without establishing a dedicated connection. UDP is used for real-time applications (e.g., video streaming, VoIP, online gaming). It also has four defining traits:</p>
<ul>
<li><strong>Simplicity:</strong> No connection setup or maintenance overhead</li>
<li><strong>Speed:</strong> Faster than TCP due to fewer checks and guarantees</li>
<li><strong>Lower Reliability:</strong> No guarantee of delivery or correct ordering</li>
<li><strong>Efficiency:</strong> Better for real-time applications where occasional data loss is acceptable</li>
</ul>
<p>Beyond those, there are some other important protocols to know, because they provide the foundation for most of the user friendly features we are used to today.</p>
<ul>
<li><strong><em>IP (Internet Protocol)</em></strong>
<ul>
<li>IP handles addressing and routing of packets across networks. There are two versions in common use:</li>
<li>IPv4: 32-bit addresses (e.g., 192.168.1.1)</li>
<li>IPv6: 128-bit addresses (e.g., 2001:0db8:85a3:0000:0000:8a2e:0370:7334)</li>
</ul></li>
<li><strong><em>ICMP (Internet Control Message Protocol)</em></strong>
<ul>
<li>ICMP helps diagnose network issues by sending error messages and operational information. The ping command uses ICMP to test connectivity.</li>
</ul></li>
<li><strong><em>HTTP/HTTPS (Hypertext Transfer Protocol)</em></strong>
<ul>
<li>HTTP and its secure variant HTTPS are application-layer protocols used for web browsing.</li>
</ul></li>
<li><strong><em>DNS (Domain Name System)</em></strong>
<ul>
<li>DNS translates human-readable domain names (like google.com) into IP addresses.</li>
</ul></li>
</ul>
</section>
</section>
<section id="network-connections" class="level3">
<h3 class="anchored" data-anchor-id="network-connections">Network Connections</h3>
<p>There are two ways for systems to connect to the internet: <strong>wired</strong> and <strong>wireless</strong>.</p>
<section id="wired-connections" class="level4">
<h4 class="anchored" data-anchor-id="wired-connections">Wired Connections</h4>
<p><strong><em>Ethernet</em></strong> is the most common wired networking technology. Its name comes from the term <em>ether</em> referring to a theoretical medium that was believed to carry light waves through space. It was developed by Robert Metcalf and David Boggs at Xerox’s PARC facility in the 1970s. The goal was to provide a more stable LAN which could facilitate high speed transfers between computers and laser printers. They succeeded, and had improved on a precursor’s, ALOHAnet, design by creating a system that could detect collisions– when two devices try to transmit at the same time. Here are some key traits:</p>
<ul>
<li><strong>Reliability:</strong> Less susceptible to interference</li>
<li><strong>Speed:</strong> Typically faster and more stable than wireless</li>
<li><strong>Security:</strong> Harder to intercept without physical access</li>
<li><strong>Connectors:</strong> RJ45 connectors on Ethernet cables</li>
<li><strong>Standards:</strong> 10/100/1000 Mbps (Gigabit) are common speeds</li>
</ul>
</section>
<section id="wireless-connections" class="level4">
<h4 class="anchored" data-anchor-id="wireless-connections">Wireless Connections</h4>
<p><strong><em>Wi-Fi</em></strong> allows devices to connect to networks without physical cables. Its name is <strong><em>not</em></strong> short for <em>Wireless Fidelity</em>, but actually a marketing choice by the brand-consulting firm Interbrand. They chose the name because it sounded similar to Hi-Fi. Wi-Fi was developed by numerous researchers and engineers, but the key breakthrough was by Dr.&nbsp;John O’Sullivan from CSIRO in Australia. His work focused on a wireless LAN, which would eventually become the <strong><em>IEEE (Institute of Electrical and Electronics Engineers)</em></strong> 802.11 standard in 1997. Eventually, Apple would help with widespread adoption by including the AirPort feature on its laptops, enabling W-Fi connectivity out of the box. Here are some key traits:</p>
<ul>
<li><strong>Convenience:</strong> No cables required, more flexible placement</li>
<li><strong>Standards:</strong> 802.11a/b/g/n/ac/ax (Wi-Fi 6) with varying speeds and ranges</li>
<li><strong>Security:</strong> WEP, WPA, WPA2, and WPA3 encryption standards (WPA2/WPA3 recommended)</li>
</ul>
</section>
<section id="network-interface-names-in-linux" class="level4">
<h4 class="anchored" data-anchor-id="network-interface-names-in-linux">Network Interface Names in Linux</h4>
<p>In Ubuntu Server, network interfaces follow a predictable naming convention:</p>
<ul>
<li><strong>eth0, eth1:</strong> Traditional Ethernet interface names</li>
<li><strong>wlan0, wlan1:</strong> Traditional wireless interface names</li>
<li><strong>enp2s0, wlp3s0:</strong> Modern predictable interface names (based on device location)</li>
</ul>
</section>
<section id="ip-addressing" class="level4">
<h4 class="anchored" data-anchor-id="ip-addressing">IP Addressing</h4>
<p>An <strong><em>IP (Internet Protocol) Address</em></strong>, is a unique identifier for a device on the internet, or a LAN. There are two different kinds of addresses: <strong><em>IPv4</em></strong> and <strong><em>IPv6</em></strong>.</p>
<p><strong><em>IPv4</em></strong> uses 32-bit addresses, providing approximately 4.3 billion unique addresses (now largely exhausted):</p>
<ul>
<li><strong>Format:</strong> Four octets (numbers 0-255) separated by dots (e.g., 192.168.1.1)</li>
<li><strong>Classes:</strong> Traditionally divided into classes A, B, C, D, and E</li>
<li><strong>Private Ranges:</strong>
<ul>
<li>10.0.0.0 to 10.255.255.255 (10.0.0.0/8)</li>
<li>172.16.0.0 to 172.31.255.255 (172.16.0.0/12)</li>
<li>192.168.0.0 to 192.168.255.255 (192.168.0.0/16)</li>
</ul></li>
<li><strong>Subnet Masks:</strong> Used to divide networks (e.g., 255.255.255.0 or /24)</li>
<li><strong>Issues:</strong> IPv4 address exhaustion due to limited capacity</li>
</ul>
<p><strong><em>IPv6</em></strong> uses 128-bit addresses, providing approximately 3.4×10^38 unique addresses:</p>
<ul>
<li><strong>Format:</strong> Eight groups of four hexadecimal digits separated by colons (e.g., 2001:0db8:85a3:0000:0000:8a2e:0370:7334)</li>
<li><strong>Shorthand:</strong> Leading zeros in a group can be omitted, and consecutive groups of zeros can be replaced with :: (only once)
<ul>
<li><strong>Example:</strong> 2001:db8:85a3::8a2e:370:7334</li>
</ul></li>
<li><strong>Address Types:</strong>
<ul>
<li><strong>Unicast:</strong> Single interface</li>
<li><strong>Anycast:</strong> Multiple interfaces (closest responds)</li>
<li><strong>Multicast:</strong> Multiple interfaces (all respond)</li>
</ul></li>
<li><strong>Benefits:</strong> More addresses, improved security, simplified headers, no need for NAT</li>
</ul>
<p>One final note, <strong><em>CIDR (Classless Inter-Domain Routing)</em></strong> notation represents IP addresses and their associated routing prefix:</p>
<ul>
<li><strong>Format:</strong> IP address followed by “/” and prefix length (e.g., 192.168.1.0/24)</li>
<li><strong>Calculation:</strong> A prefix of /24 means the first 24 bits are the network portion, leaving 8 bits for hosts (allowing 2^8 = 256 addresses)</li>
</ul>
</section>
</section>
<section id="ubuntu-server-networking-tools" class="level3">
<h3 class="anchored" data-anchor-id="ubuntu-server-networking-tools">Ubuntu Server Networking Tools</h3>
<p>Now that we’ve covered the basic concepts, it’s time to dive into the actual commands and tools that will let you configure and manage your server’s network. To start, you can view network interfaces and their statuses using the command <code>ip link show</code>, or <code>ip addr show</code> for your IP Address configuration. You can view only the IPv4 or IPv6 addresses using <code>ip -4 addr</code> or <code>ip -6 addr</code>, respectively.</p>
<section id="testing-connectivity" class="level4">
<h4 class="anchored" data-anchor-id="testing-connectivity">Testing Connectivity</h4>
<p>Although it seems redundant if you already viewed your IP addresses, you can also test connectivity using the <code>ping</code> and <code>traceroute</code> commands. These will be more useful for checking your servers network status from your desktop or laptop.</p>
<p><strong>Test basic connectivity to a host:</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ping</span> google.com</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Trace the route to a destination:</strong></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">traceroute</span> google.com</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Check the DNS resolution:</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> google.com</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dig google.com</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="viewing-network-statistics" class="level4">
<h4 class="anchored" data-anchor-id="viewing-network-statistics">Viewing Network Statistics</h4>
<p>You can view more specific network information with the <code>ss</code> command. This command’s name is an acronym for <code>socket statistics</code> and is used as a replacement for the older netstat plan because it offers faster performance and a more detailed output. Additionally, you can filter by specific protocol.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ss</span> <span class="at">-tuln</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>tuln</code> flag is made up of four separate flags:</p>
<ul>
<li><code>-t</code>, displays only TCP sockets</li>
<li><code>-u</code>, displays only UDP sockets</li>
<li><code>-l</code>, displays listening sockets</li>
<li><code>-n</code>, displays address numerically, instead of resolving them</li>
</ul>
</section>
<section id="configuration-files" class="level4">
<h4 class="anchored" data-anchor-id="configuration-files">Configuration Files</h4>
<p>Finally, there are a few crucial configuration files that will handle the bulk of your networking. In Ubuntu Server, network interfaces and DNS configurations are configured and stored in the <code>/etc/</code> directory.</p>
<p><strong>Network Interfaces:</strong></p>
<ul>
<li><code>/etc/netplan/:</code> Contains YAML configuration files for Netplan</li>
<li><code>/etc/network/interfaces:</code> Configuration method (if NetworkManager is used)</li>
</ul>
<p><strong>DNS Configuration:</strong></p>
<ul>
<li><strong>/etc/resolv.conf:</strong> DNS resolver configuration</li>
<li><strong>/etc/hosts:</strong> Static hostname to IP mappings</li>
<li><strong>/etc/hostname:</strong> System hostname</li>
</ul>
</section>
</section>
<section id="systemd-networkd" class="level3">
<h3 class="anchored" data-anchor-id="systemd-networkd">systemd-networkd</h3>
<p><strong><em>systemd-networkd</em></strong> is a system daemon that manages network configurations in modern Linux distributions. It’s part of the systemd suite and provides network configuration capabilities through simple configuration files.</p>
<p>It generally works using three key components:</p>
<ul>
<li><strong>Configuration Files:</strong> You define network settings in .network files located in /etc/systemd/network/</li>
<li><strong>Service Management:</strong> systemd-networkd runs as a system service to apply and maintain network configurations</li>
<li><strong>Integration:</strong> Works closely with other systemd components for DNS resolution and networking</li>
</ul>
<section id="basic-wired-configuration" class="level4">
<h4 class="anchored" data-anchor-id="basic-wired-configuration">Basic Wired Configuration</h4>
<p><strong><em>systemd-networkd</em></strong> uses configuration files with .network extension. Each file consists of sections with key-value pairs. A basic configuration for a static IP would look like this:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/systemd/network/20-wired.network</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">[Match]</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Name</span><span class="ot">=</span><span class="st">eth0</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[Network]</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="dt">Address</span><span class="ot">=</span><span class="st">192.168.1.100/24</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="dt">Gateway</span><span class="ot">=</span><span class="st">192.168.1.1</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="dt">DNS</span><span class="ot">=</span><span class="st">8.8.8.8</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="dt">DNS</span><span class="ot">=</span><span class="st">8.8.4.4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s walk through the configuration file’s structure:</p>
<ul>
<li><strong>File Naming Convention:</strong>
<ul>
<li>The file is named 20-wired.network.</li>
<li>The number prefix (20-) determines the processing order (lower numbers processed first), allowing you to create prioritized configurations.</li>
<li>The suffix .network tells systemd-networkd that this is a network interface configuration file.</li>
</ul></li>
<li><strong>[Match] Section:</strong>
<ul>
<li>This critical section determines which network interfaces the configuration applies to.</li>
<li><code>Name=eth0</code>: This specifies that the configuration should apply to the eth0 interface only.</li>
<li>You can use wildcards (e.g., eth* would match all Ethernet interfaces) or match by other properties such as MAC address using MACAddress=xx:xx:xx:xx:xx:xx.</li>
<li><em>Behind the scenes:</em>
<ul>
<li>systemd-networkd scans all available network interfaces.</li>
<li>Compares their properties against those specified in the [Match] section.</li>
<li>If all properties match, the configuration is applied to that interface.</li>
</ul></li>
</ul></li>
<li><strong>[Network] Section:</strong>
<ul>
<li>This section defines the network configuration parameters.</li>
<li><code>Address=192.168.1.100/24</code>: Sets a static IPv4 address with CIDR notation. The /24 represents the subnet mask (equivalent to 255.255.255.0) and defines the network boundary.</li>
<li><code>Gateway=192.168.1.1</code>: Specifies the default gateway for routing traffic outside the local network. All traffic not destined for the local subnet (192.168.1.0/24) will be sent to this IP address.</li>
<li><code>DNS=8.8.8.8</code> and <code>DNS=8.8.4.4</code>: These are Google’s public DNS servers. When specified, systemd-networkd will automatically configure /etc/resolv.conf through systemd-resolved. You can specify multiple DNS servers, and they will be tried in order.</li>
</ul></li>
<li><strong>Behind the scenes:</strong>
<ul>
<li>systemd-networkd identifies the eth0 interface</li>
<li>Assigns the static IP address using kernel netlink sockets</li>
<li>Sets up the routing table to use the specified gateway</li>
<li>Communicates with systemd-resolved to configure DNS settings</li>
<li>Maintains this configuration and reapplies it if the interface goes down and back up</li>
</ul></li>
</ul>
<p>This configuration example works well for server environments where static, predictable networking is preferable. This is a declarative configuration, it describes the desired state, rather than the steps to achieve it, so repeated application produces the same result.</p>
</section>
<section id="dhcp-with-a-wired-connection" class="level4">
<h4 class="anchored" data-anchor-id="dhcp-with-a-wired-connection">DHCP with a Wired Connection</h4>
<p>If you want to add DHCP, you can use the following:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/systemd/network/20-wired.network</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">[Match]</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Name</span><span class="ot">=</span><span class="st">eth0</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[Network]</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="dt">DHCP</span><span class="ot">=</span><span class="kw">yes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s walk through the differences between a dynamic and static host configuration file structure:</p>
<ul>
<li><code>DHCP=yes</code>: This single line replaces all the static configuration parameters from the previous example.
<ul>
<li>It instructs systemd-networkd to obtain IP address, subnet mask, gateway, DNS servers, and other network parameters automatically from a DHCP server.</li>
<li>You can also use <code>DHCP=ipv4</code> to enable only IPv4 DHCP, or <code>DHCP=ipv6</code> for only IPv6 DHCP, or <code>DHCP=yes</code> for both.</li>
</ul></li>
<li><strong>Behind the scenes:</strong>
<ul>
<li>systemd-networkd identifies the eth0 interface</li>
<li>Initiates the DHCP client process, which follows the DHCP protocol’s Discover-Offer-Request-Acknowledge (DORA) sequence:
<ul>
<li>The client broadcasts a DISCOVER message</li>
<li>Available DHCP servers respond with OFFER messages</li>
<li>The client selects an offer and sends a REQUEST</li>
<li>The selected server sends an ACKNOWLEDGE</li>
</ul></li>
<li>Applies all the received network parameters (IP, subnet, gateway, DNS)</li>
<li>Sets up a lease timer to manage when the configuration needs renewal</li>
<li>Handles DHCP lease renewals automatically</li>
</ul></li>
<li><strong>Advantages:</strong>
<ul>
<li>Simplified configuration maintenance - no need to update parameters when network details change</li>
<li>Works well in networks where IP assignments are centrally managed</li>
<li>Automatically adapts to network changes</li>
</ul></li>
</ul>
<p>This configuration works well for environments where network parameters are dynamic or managed by a network admin through DHCP.</p>
</section>
<section id="wireless-configurations-and-wpa_supplicant" class="level4">
<h4 class="anchored" data-anchor-id="wireless-configurations-and-wpa_supplicant">Wireless Configurations and wpa_supplicant</h4>
<p>While wired connections are a basic part of networking, wireless connections require some extra work. More specifically, with systemd-networkd, you’ll need a tool like WPA. Wi-Fi Protected Access (WPA) emerged as a response to weaknesses in the original Wired Equivalent Privacy (WEP) security protocol. As wireless networks became ubiquitous, secure authentication and encryption mechanisms became essential. The Linux ecosystem offers several powerful tools for managing these connections:</p>
<ul>
<li><code>wpa_supplicant</code>: The core daemon that handles wireless connections</li>
<li><code>wpa_cli</code>: A command-line interface for controlling wpa_supplicant dynamically</li>
<li><code>wpa_passphrase</code>: A utility for generating secure password hashes</li>
</ul>
<p>On the <code>systemd-networkd</code> side of things, the configuration is simple, broken down in detail below.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/systemd/network/25-wireless.network</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">[Match]</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Name</span><span class="ot">=</span><span class="st">wlan0</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[Network]</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="dt">DHCP</span><span class="ot">=</span><span class="kw">yes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>Wireless Interface:</strong>
<ul>
<li>The configuration targets wlan0, which is the traditional name for the first wireless network interface in Linux.</li>
</ul></li>
<li><strong>Minimal Configuration:</strong>
<ul>
<li>The file only has the information needed by systemd-networkd to manage the IP addressing aspect of the wireless connection. Note what’s missing: there’s no SSID, password, or security protocol information. This is because:</li>
<li>systemd-networkd isn’t designed to handle wireless authentication and association</li>
<li>This separation of concerns is intentional in the systemd design philosophy - specialized tools should handle specialized tasks</li>
</ul></li>
<li><strong>Integration with wpa_supplicant:</strong>
<ul>
<li><code>wpa_supplicant</code> is the standard Linux utility for managing wireless connections</li>
<li><code>systemd-networkd</code> handles the network layer (Layer 3) configuration once wpa_supplicant establishes the data link layer (Layer 2) connection</li>
<li>This division follows the OSI model’s separation of network layers</li>
</ul></li>
<li><strong>Behind the scenes:</strong>
<ul>
<li>wpa_supplicant handles wireless scanning, authentication, and association</li>
<li>Once a wireless link is established, it notifies the system</li>
<li>systemd-networkd detects the active interface that matches wlan0</li>
<li>It then initiates the DHCP client process to configure the network parameters</li>
</ul></li>
<li>This separation provides flexibility and security
<ul>
<li>The wireless security operations are handled by a dedicated, well-tested component</li>
<li>Networking remains under systemd-networkd’s control for consistency with other interfaces</li>
</ul></li>
</ul>
<p>While the <code>systemd-networkd</code> configuration is straightforward, things get more complicated with WPA. In standard wpa_supplicant configuration files, wireless passwords are often stored in plaintext. This creates a security vulnerability - anyone with access to the configuration file can view the password.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/wpa_supplicant/wpa_supplicant-wlan0.conf</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">ctrl_interface</span><span class="ot">=</span><span class="st">/run/wpa_supplicant</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="dt">update_config</span><span class="ot">=</span><span class="dv">1</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="dt">network</span><span class="ot">=</span><span class="st">{</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="dt">    ssid</span><span class="ot">=</span><span class="st">"YourNetworkSSID"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="dt">    psk</span><span class="ot">=</span><span class="st">"YourWiFiPassword"</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="dt">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>wpa_passphrase</code> tool solves this problem by generating a pre-computed hash of the password. Running this is straightforward as the basic syntax is <code>wpa_passphrase [SSID] [passphrase]</code>. Then, WPA outputs a hashed version of your password.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a hashed passphrase</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">wpa_passphrase</span> <span class="st">"MyHomeNetwork"</span> <span class="st">"MySecurePassword123"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>To then use the hashed password in your configuration, you can run the following command, just make sure to remove the line with the plaintext password from the config file after runtime:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the hash and save directly to the configuration file</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">wpa_passphrase</span> <span class="st">"MyHomeNetwork"</span> <span class="st">"MySecurePassword123"</span> <span class="kw">|</span> <span class="fu">sudo</span> tee <span class="at">-a</span> /etc/wpa_supplicant/wpa_supplicant-wlan0.conf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>When you use wpa_passphrase:</strong> - It combines the SSID and password using the PBKDF2 (Password-Based Key Derivation Function 2) algorithm - It applies 4096 iterations of HMAC-SHA1 for key strengthening - The result is a 256-bit (32-byte) hash represented in hexadecimal format - This hash is what’s actually used for the authentication process, not the original password</p>
<p>This approach makes it virtually impossible to reverse-engineer the original password from the hash.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/wpa_supplicant/wpa_supplicant-wlan0.conf</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="dt">ctrl_interface</span><span class="ot">=</span><span class="st">/run/wpa_supplicant</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="dt">update_config</span><span class="ot">=</span><span class="dv">1</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="dt">network</span><span class="ot">=</span><span class="st">{</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="dt">    ssid</span><span class="ot">=</span><span class="st">"MyHomeNetwork"</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="dt">    </span><span class="co">#psk="MySecurePassword123"</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="dt">    psk</span><span class="ot">=</span><span class="st">a8e665b82929d810746c5a1208c472f9d2a25db67a6bc32a99fa4158aea02175</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="dt">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that you have an idea about the basic structure of this file, lets go over some key points:</p>
<ul>
<li><strong>File Naming Convention:</strong>
<ul>
<li>The file wpa_supplicant-wlan0.conf is specifically named to associate with the wlan0 interface.</li>
<li>This naming allows different wireless interfaces to have different configurations.</li>
</ul></li>
<li><strong>Configuration Directives:</strong>
<ul>
<li><code>ctrl_interface=/run/wpa_supplicant</code>: This specifies the control interface path, which is a socket that allows programs to communicate with wpa_supplicant. This enables tools like wpa_cli to connect and control wpa_supplicant dynamically.</li>
<li><code>update_config=1</code>: Allows wpa_supplicant to update the configuration file automatically, useful when network details change or when using wpa_cli to add networks interactively.</li>
</ul></li>
<li><strong>Network Block:</strong>
<ul>
<li>The <code>network={}</code> block defines a single wireless network configuration.</li>
<li><code>ssid="YourNetworkSSID"</code>: The Service Set Identifier - the name of the wireless network to connect to.</li>
<li><code>psk="YourWiFiPassword"</code>: The Pre-Shared Key - the password for the wireless network in plaintext.</li>
</ul></li>
<li><strong>Security Considerations:</strong>
<ul>
<li>When you enter the password in plaintext as shown, wpa_supplicant will automatically convert it to a hash during processing.</li>
<li>For better security, you can pre-hash the password using: wpa_passphrase “YourNetworkSSID” “YourWiFiPassword” and use the generated hash.</li>
<li>The configuration file should have restricted permissions (600) to prevent other users from reading the passwords.</li>
</ul></li>
<li><strong>Behind the scenes:</strong>
<ul>
<li>wpa_supplicant reads this configuration at startup</li>
<li>It scans for available wireless networks</li>
<li>When it finds the specified SSID, it attempts to authenticate using the provided credentials</li>
<li>It handles all the wireless protocol handshakes, including:
<ul>
<li>Authentication and association with the access point</li>
<li>Negotiation of encryption parameters</li>
<li>Establishment of the encrypted channel</li>
</ul></li>
</ul></li>
</ul>
<p>Once connected, it maintains the connection and handles roaming between access points with the same SSID. This configuration represents the minimum needed for a WPA/WPA2 Personal network connection. For more complex scenarios like enterprise authentication (WPA-EAP), additional parameters would be needed in the network block.</p>
<p>While the <code>wpa_supplicant</code> configuration files provide static configuration that saves when you write out, <code>wpa_cli</code> offers interactive, dynamic control over wireless connections. First ensure <code>wpa_supplicant</code> is running with a control interface by using <code>ps aux | grep wpa_supplicant</code>. If it’s running with the <code>-c</code> flag pointing to a config file that contains the <code>ctrl_interface=/run/wpa_supplicant</code> line, you can connect to it.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>As a heads up, because we already created the wlan0 configuration file manually, the following steps are just for your knowledge. You’ll probably get some messages saying <code>FAIL</code> if you try to run some of the commands, but I think it’s good to learn them anyways– even though they aren’t necessarilly important right now.</p>
</div>
</div>
<p>First, start the interactive mode with <code>sudo wpa_cli</code>, or specify the interface with <code>sudo wpa_cli -i wlan0</code>. Let’s go over some essential commands:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show help</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># List all available commands</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="bu">help</span> all</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co"># List available networks</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="ex">scan</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="ex">scan_results</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Show current status</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="ex">status</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># List configured networks</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="ex">list_networks</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new network</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="ex">add_network</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Step-By-Step: Adding a Network</strong></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> add_network</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> set_network <span class="ex">0</span> ssid <span class="st">"MyNetwork"</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> set_network <span class="ex">0</span> psk <span class="st">"MyPassword"</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> set_network <span class="ex">0</span> priority 5 </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> enable_network <span class="ex">0</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> save_config</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># For networks with hashed passwords</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> add_network</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> set_network <span class="ex">1</span> ssid <span class="st">"MyNetwork"</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> set_network <span class="ex">1</span> psk 0a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0u1v2w3x4y5z</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> set_network <span class="ex">1</span> priority 10</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> enable_network <span class="ex">1</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> save_config</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="ex">OK</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>It’s good to know that higher priority values (like 10), are preferred over lower ones (like 5). Now, you can also use <code>wpa</code> by running one off commands or writing scripts with <em>non-interactive</em> mode. Additionally, you should know that when you first boot up your Raspberry Pi, the internet will be managed by Netplan (more on that later in this section). So, if you try to use <code>wpa_cli save_config</code> after creating the config files, that will return <code>FAIL</code>. Instead, once you write the files in the proper directories, run the <code>reconfigure</code> command.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scan for networks</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> wpa_cli scan</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> wpa_cli scan_results</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the current configuration</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> wpa_cli save_config</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Reconnect to the network</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> wpa_cli reconfigure</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, you can monitor signal quality and connection status by using the <code>signal_poll</code> command. The RSSI (Received Signal Strength Indicator) shows connection quality in dBm. Values closer to 0 indicate stronger signals. Additionally, you can debug connection issues using <code>status</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> signal_poll</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="va">RSSI</span><span class="op">=</span>-67</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="va">LINKSPEED</span><span class="op">=</span>65</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="va">NOISE</span><span class="op">=</span>9999</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="va">FREQUENCY</span><span class="op">=</span>5220</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> status</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="va">bssid</span><span class="op">=</span>00:11:22:33:44:55</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="va">freq</span><span class="op">=</span>5220</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="va">ssid</span><span class="op">=</span>MyNetwork</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="va">id</span><span class="op">=</span>0</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="va">mode</span><span class="op">=</span>station</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="va">pairwise_cipher</span><span class="op">=</span>CCMP</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="va">group_cipher</span><span class="op">=</span>CCMP</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="va">key_mgmt</span><span class="op">=</span>WPA2-PSK</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="va">wpa_state</span><span class="op">=</span>COMPLETED</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="va">ip_address</span><span class="op">=</span>192.168.1.100</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now that we’ve covered a lot of the great features available with wpa_cli, it’s time to continue configuring our server. You may remember me mentioning that the Raspberry Pi default networking tool is Netplan. Before we can enable and start the <code>wlan0</code> service (meaning your primary wifi is on), we need to safely shut down Netplan.</p>
</section>
</section>
<section id="converting-netplan-to-networkd" class="level3">
<h3 class="anchored" data-anchor-id="converting-netplan-to-networkd">Converting Netplan to networkd</h3>
<p>It’s no surprise that Raspberry Pi uses Netplan as the default network manager because it provides a consistent interface for network configuration; however, there are several reasons you might want to use systemd-networkd directly:</p>
<ul>
<li><strong>Simplicity:</strong> Direct systemd-networkd configuration eliminates a layer of abstraction</li>
<li><strong>Control:</strong> Direct access to all of systemd-networkd’s features without Netplan’s limitations</li>
<li><strong>Integration:</strong> Better alignment with other systemd components</li>
<li><strong>Learning:</strong> Understanding the underlying network configuration system</li>
<li><strong>Performance:</strong> Potentially faster setup without the translation layer</li>
</ul>
<p>Ubuntu Server uses a layered approach to network configuration:</p>
<ul>
<li><strong>User configuration layer:</strong> YAML files in /etc/netplan/</li>
<li><strong>Translation layer:</strong> Netplan reads YAML files and generates configurations for a backend</li>
<li><strong>Backend layer:</strong> Either systemd-networkd or NetworkManager applies the actual configuration</li>
</ul>
<p>By removing the middle layer (Netplan), we’re configuring the backend directly. As you can see from the previous parts of this Networking section in the guide, I like the learning value and longterm potential of systemd, which is why I went with it over Netplan.</p>
<section id="step-by-step-migration" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-migration">Step-by-step Migration</h4>
<ol type="1">
<li>Begin by creating backups of your current network configuration</li>
</ol>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a backup directory</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /etc/netplan/backups</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Copy all netplan config files</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cp /etc/netplan/<span class="pp">*</span>.yaml /etc/netplan/backups/</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Document the current network state</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ip <span class="at">-c</span> addr <span class="kw">|</span> <span class="fu">sudo</span> tee /etc/netplan/backups/current-ip-addr.txt</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ip <span class="at">-c</span> route <span class="kw">|</span> <span class="fu">sudo</span> tee /etc/netplan/backups/current-ip-route.txt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>Review your existing Netplan so you know what to recreate</li>
</ol>
<div class="sourceCode" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View your current netplan configs</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> /etc/netplan/<span class="pp">*</span>.yaml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>Now, create the corresponding systemd-networkd configuration files in <code>/etc/systemd/network/</code>.
<ol type="1">
<li>For each interface (wired, wireless, etc.) in your Netplan configuration, create a corresponding <code>.network</code> file, with the appropriate configurations (i.e.&nbsp;static vs.&nbsp;DHCP).</li>
<li><strong>Remember:</strong> For wireless connections, you need <em>both</em> a systemd and a wpasupplicant configuration.</li>
</ol></li>
</ol>
<div class="sourceCode" id="cb32"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the directory if it doesn't exist</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /etc/systemd/network/</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co"># For an Ethernet configuration</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/systemd/network/20-wired.network</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># For a Wireless configuration</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/systemd/network/25-wireless.network</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/wpa_supplicant/wpa_supplicant-wlan0.conf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li>Now that your networkd configuration is in place, disable Netplan.</li>
</ol>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure systemd-networkd is enabled</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable systemd-networkd</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable systemd-resolved</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl start systemd-networkd</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Move the Netplan configurations to a disabled state</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /etc/netplan/disabled</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mv /etc/netplan/<span class="pp">*</span>.yaml /etc/netplan/disabled/</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a minimal netplan configuration that defers to systemd-networkd</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> tee /etc/netplan/01-network-manager-all.yaml <span class="op">&gt;</span> /dev/null <span class="op">&lt;&lt; EOF</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="st">network:</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="st">  version: 2</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="st">  renderer: networkd</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s take a look at the systemctl <code>enable</code> and <code>start</code> commands, because without them we will lose connectivity when turning off netplan. Before we do that, however, what the minimal netplan configuration file does is essentially tell Netplan to just use networkd. We’ll remove it once we are sure everything is up and running.</p>
<ul>
<li><strong>Enable Command:</strong>
<ul>
<li><code>sudo systemctl enable systemd-networkd</code>: This configures systemd-networkd to start automatically when the system boots.</li>
<li>Behind the scenes:
<ul>
<li>This command creates the necessary symbolic links in systemd’s unit directories so that the network daemon will be started by systemd during the boot process.</li>
<li>It integrates the service into systemd’s dependency tree.</li>
<li>Without this step, you would need to manually start networkd after each reboot, which is impractical for a server environment.</li>
</ul></li>
</ul></li>
<li><strong>Start Command:</strong>
<ul>
<li><code>sudo systemctl start systemd-networkd</code>: This launches the systemd-networkd daemon immediately.</li>
<li>Behind the scenes:
<ul>
<li>systemd spawns the networkd process, which then:
<ul>
<li>Reads all .network, .netdev, and .link configuration files in <code>/etc/systemd/network/</code> and <code>/usr/lib/systemd/network/</code></li>
<li>Applies the configurations to matching interfaces</li>
<li>Sets up monitoring for network changes</li>
</ul></li>
</ul></li>
</ul></li>
<li><strong>Restart Command:</strong>
<ul>
<li><code>sudo systemctl restart systemd-networkd</code>: This stops and then starts the daemon again, ensuring all configuration changes are applied.</li>
<li>Behind the scenes:
<ul>
<li>systemd sends a termination signal to the running networkd process, waits for it to exit cleanly, and then starts a new instance.</li>
<li>The new instance repeats the initialization process, reading all configuration files again.</li>
<li>This is the command you’ll use most frequently when making changes to network configurations.</li>
</ul></li>
</ul></li>
<li><strong>Why Restart Is Necessary:</strong>
<ul>
<li>While systemd-networkd does monitor for some changes, editing configuration files doesn’t automatically trigger a reconfiguration.</li>
<li>The restart ensures that:
<ul>
<li>All new or modified configuration files are re-read</li>
<li>Any removed configurations are no longer applied</li>
<li>All interface configurations are freshly evaluated against the current state</li>
</ul></li>
</ul></li>
<li><strong>Impact on Network Connectivity:</strong>
<ul>
<li>A restart will temporarily disrupt network connectivity as interfaces are reconfigured</li>
<li>For remote servers, use caution when restarting network services to avoid losing your connection</li>
<li>For critical remote systems, consider using a command pipeline, like:
<ul>
<li><code>sudo systemctl restart systemd-networkd.service || (sleep 30 &amp;&amp; sudo systemctl start systemd-networkd.service)</code></li>
<li>Which attempts to restart and then tries to start the service again after 30 seconds if connectivity is lost</li>
</ul></li>
</ul></li>
</ul>
<ol start="5" type="1">
<li>Apply the systemd-networkd network configuration</li>
</ol>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply Netplan changes (this will do nothing as we now have a minimal config)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> netplan apply</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Restart systemd-networkd to apply our direct configuration</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart systemd-networkd</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The next step is to enable and start the wpa_supplicant service.</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable wpa_supplicant@wlan0.service</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl start wpa_supplicant@wlan0.service</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These commands are crucial for integrating wpa_supplicant with systemd, let’s break them down:</p>
<ul>
<li><strong>Service Template:</strong>
<ul>
<li>The <code>wpa_supplicant@wlan0.service</code> syntax uses systemd’s template unit feature.</li>
<li>The @ symbol indicates a template service, and wlan0 is the instance name that gets passed to the template.</li>
<li>This allows the same service definition to be used for different wireless interfaces.</li>
</ul></li>
<li><strong>Enable Command:</strong>
<ul>
<li><code>sudo systemctl enable wpa_supplicant@wlan0.service</code>: This creates symbolic links from the system’s service definition directory to systemd’s active service directory, ensuring the service starts automatically at boot.</li>
<li>Behind the scenes:
<ul>
<li>This modifies systemd’s startup configuration by adding the service to the correct target units. Typically multi-user.target.</li>
<li>The symbolic links created point to the wpa_supplicant service template file.</li>
</ul></li>
</ul></li>
<li><strong>Start Command:</strong>
<ul>
<li><code>sudo systemctl start wpa_supplicant@wlan0.service</code>: This immediately starts the service without waiting for a reboot.</li>
<li>Behind the scenes:
<ul>
<li>systemd executes the wpa_supplicant binary with appropriate arguments</li>
<li>Derived from the service template and the instance name (wlan0).</li>
<li>The command effectively executed is similar to: <code>/usr/sbin/wpa_supplicant -c /etc/wpa_supplicant/wpa_supplicant-wlan0.conf -i wlan0</code></li>
</ul></li>
</ul></li>
<li><strong>Integration with systemd-networkd:</strong>
<ul>
<li>When wpa_supplicant successfully connects to a wireless network, it brings the interface up</li>
<li>systemd-networkd detects this state change through kernel events</li>
<li>systemd-networkd then applies the matching network configuration (our earlier 25-wireless.network file)</li>
<li>If DHCP is enabled, the DHCP client process begins</li>
</ul></li>
<li><strong>Benefits of this systemd configuration:</strong>
<ul>
<li>Dependency management (services can start in the correct order)</li>
<li>Automatic restart if the service fails</li>
<li>Standardized logging through journald</li>
<li>Consistent management interface alongside other system services</li>
<li>The template approach allows for modular configuration that can be easily expanded if you add more wireless interfaces to your Raspberry Pi.</li>
</ul></li>
</ul>
<ol start="6" type="1">
<li>Verify the new configuration</li>
</ol>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check systemd-networkd status</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="ex">systemctl</span> status systemd-networkd</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check interface status</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ip</span> addr show</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Test connectivity</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ping</span> <span class="at">-c</span> 4 8.8.8.8</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ping</span> <span class="at">-c</span> 4 google.com</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>You should see outputs that look like this:</strong> Note, I didn’t show the output of <code>id addr</code> because I don’t want to accidentally post my actual IP address online.</p>
<p><img src="images/networkd-status.png" class="img-fluid"></p>
<p><img src="images/ping_google.png" class="img-fluid"></p>
<ol start="7" type="1">
<li>Make the change permanent</li>
</ol>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the minimal Netplan configuration</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> rm /etc/netplan/01-network-manager-all.yaml</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask the Netplan service to prevent it from running</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl mask netplan-wpa@.service</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl mask netplan-ovs-cleanup.service</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl mask netplan-wpa-wlan0.service</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>One final note before moving on, by the time I removed the generic netplan configuration, my system did not have <code>netplan-wpa.service</code> or <code>netplan-wpa-wlan0.service</code>. I forgot to look before I tested the previous steps, so I’m not sure if I did, but I’ll leave them here just in case someone needs them. That being said, I was able to mask <code>netplan-ovs-cleanup.service</code> successfully.</p>
</section>
<section id="troubleshooting" class="level4">
<h4 class="anchored" data-anchor-id="troubleshooting">Troubleshooting</h4>
<p>Once you’ve finished making changes and applying them, verify that everything is up, running, and as you expect.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check systemd-networkd status</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">systemctl</span> status systemd-networkd</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View network status</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="ex">networkctl</span> status</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co"># List all network links</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="ex">networkctl</span> list</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>These are crucial commands for troubleshooting and confirming your network configuration, let’s break them down:</p>
<ul>
<li><strong>systemd-networkd Status Check:</strong>
<ul>
<li><code>systemctl status systemd-networkd</code>: This displays the current status of the systemd-networkd service. The output includes:
<ul>
<li>Whether the service is active, inactive, or failed</li>
<li>When it was started and how long it’s been running</li>
<li>The process ID and memory usage</li>
<li>Recent log entries directly related to the service</li>
</ul></li>
<li>Behind the scenes:
<ul>
<li>This queries systemd’s internal service management database and pulls relevant information from the journal logging system.</li>
<li>Useful pattern: Look for “Active: active (running)” to confirm the service is working properly and check the logs for any warning or error messages.</li>
</ul></li>
</ul></li>
<li><strong>Network Status Overview:</strong>
<ul>
<li><code>networkctl status</code>: This command provides a comprehensive overview of your system’s network state.
<ul>
<li>The output includes:
<ul>
<li>Hostname and domain information</li>
<li>Gateway and DNS server configurations</li>
<li>Current network interfaces and their states</li>
<li>Network addresses (IPv4 and IPv6)</li>
</ul></li>
</ul></li>
<li>Behind the scenes:
<ul>
<li>This tool directly communicates with systemd-networkd using its D-Bus API to retrieve the current network state.</li>
<li>This command is particularly useful because it aggregates information that would otherwise require multiple different commands to collect.</li>
</ul></li>
</ul></li>
<li><strong>Network Links Enumeration:</strong>
<ul>
<li><code>networkctl list</code>: This lists all network interfaces known to systemd-networkd.
<ul>
<li>The output shows:
<ul>
<li>Interface index numbers</li>
<li>Interface names</li>
<li>Interface types (ether, wlan, loopback, etc.)</li>
<li>Operational state (up, down, dormant, etc.)</li>
<li>Setup state (configured, configuring, unmanaged)</li>
</ul></li>
</ul></li>
<li>Behind the scenes:
<ul>
<li>Like the status command, this uses systemd-networkd’s D-Bus API to enumerate all network links and their current states.</li>
<li>This provides a quick way to verify which interfaces systemd-networkd is managing and their current status.</li>
</ul></li>
</ul></li>
<li><strong>Troubleshooting with These Commands:</strong>
<ul>
<li>Start with systemctl status systemd-networkd to ensure the service is running</li>
<li>Use networkctl list to see which interfaces are detected and their states</li>
<li>If an interface shows “configuring” instead of “configured,” check for configuration errors</li>
<li>Use networkctl status to verify DNS settings and addressing</li>
<li>For more detailed logs: journalctl -u systemd-networkd shows all logs from the networkd service</li>
</ul></li>
</ul>
<p>These commands represent the primary diagnostic tools when working with systemd-networkd. They provide a layered approach to troubleshooting - from service-level status to detailed interface information - that helps pinpoint issues in your network configuration. If you need more:</p>
<ul>
<li><strong>Network Connectivity Loss:</strong>
<ul>
<li>Connect directly to the device via console or keyboard/monitor</li>
<li>Check logs with <code>journalctl -u systemd-networkd</code></li>
<li>Restore the Netplan configuration from your backup if needed</li>
</ul></li>
<li><strong>DNS Resolution Issues:</strong>
<ul>
<li>Ensure systemd-resolved is running: <code>systemctl status systemd-resolved</code></li>
<li>Check <code>/etc/resolv.conf</code> is a symlink to <code>/run/systemd/resolve/stub-resolv.conf</code></li>
<li>If not, create it: <code>sudo ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf</code></li>
</ul></li>
<li><strong>Configuration Errors:</strong>
<ul>
<li>Verify syntax with <code>networkctl list</code> to see if interfaces are “configured” or “configuring”</li>
<li>Check for errors with <code>journalctl -u systemd-networkd -n 50</code></li>
</ul></li>
</ul>
</section>
</section>
<section id="advanced-networking" class="level3">
<h3 class="anchored" data-anchor-id="advanced-networking">Advanced Networking</h3>
<section id="subnets" class="level4">
<h4 class="anchored" data-anchor-id="subnets">Subnets</h4>
<p>A subnet is a logical subdivision of an IP network. Subnetting allows network administrators to partition a large network into smaller, more manageable segments. Subnetting serves several important functions:</p>
<ul>
<li>Address Conservation: More efficient allocation of limited IPv4 address space</li>
<li>Security Segmentation: Isolating sensitive systems from general network traffic</li>
<li>Broadcast Domain Control: Reducing broadcast traffic by limiting its scope</li>
<li>Hierarchical Addressing: Simplifying routing tables and network management</li>
<li>Traffic Optimization: Improving network performance by segregating traffic types</li>
</ul>
<p>A subnet mask determines which portion of an IP address refers to the network and which portion refers to hosts within that network. Consider an IPv4 address: 192.168.1.10 with subnet mask 255.255.255.0 (/24)</p>
<ul>
<li><strong>In binary:</strong>
<ul>
<li>IP: 11000000.10101000.00000001.00001010</li>
<li>Mask: 11111111.11111111.11111111.00000000</li>
<li>The 1s in the mask represent the network portion, while the 0s represent the host portion.</li>
</ul></li>
<li><strong>In CIDR Notation:</strong>
<ul>
<li>/24 means the first 24 bits identify the network (equivalent to 255.255.255.0)</li>
<li>/16 means the first 16 bits identify the network (equivalent to 255.255.0.0)</li>
</ul></li>
<li><strong>Subnet Calculations:</strong> For a /24 network
<ul>
<li><strong>Network address:</strong> First address in range (e.g., 192.168.1.0)</li>
<li><strong>Broadcast address:</strong> Last address in range (e.g., 192.168.1.255)</li>
<li><strong>Available host addresses:</strong> 2^(32-prefix) - 2 = 2^8 - 2 = 254 usable addresses</li>
</ul></li>
</ul>
<p>Creating subnets involves both network design and interface configuration. Here’s how to implement subnetting on a Linux server using systemd-networkd:</p>
<ul>
<li><strong>Scenario 1:</strong> Simple Subnet Isolation
<ul>
<li>This configuration matches the eth1 interface</li>
<li>Assigns it the IP 10.0.1.1 within a /24 subnet (255.255.255.0)</li>
<li>Enables IP forwarding to allow traffic between this subnet and others</li>
<li>When applied, this creates a subnet with 254 usable addresses (10.0.1.1 through 10.0.1.254, excluding the network address 10.0.1.0 and broadcast address 10.0.1.255).</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/systemd/network/25-subnet.network</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">[Match]</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Name</span><span class="ot">=</span><span class="st">eth1</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[Network]</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="dt">Address</span><span class="ot">=</span><span class="st">10.0.1.1/24</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="dt">IPForward</span><span class="ot">=</span><span class="kw">yes</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>Scenario 2:</strong> Multiple Subnets on a Single Interface
<ul>
<li>This configuration creates three separate subnets accessed through the same physical interface
<ul>
<li>A /24 subnet (256 addresses) in the 192.168.1.x range</li>
<li>A /24 subnet (256 addresses) in the 10.10.10.x range</li>
<li>A /16 subnet (65,536 addresses) in the 172.16.x.x range</li>
</ul></li>
</ul></li>
</ul>
<p>The system serves as a router/gateway for all three networks simultaneously.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/systemd/network/30-multi-subnet.network</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">[Match]</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Name</span><span class="ot">=</span><span class="st">eth0</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[Network]</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="dt">Address</span><span class="ot">=</span><span class="st">192.168.1.10/24</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="dt">Address</span><span class="ot">=</span><span class="st">10.10.10.1/24</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="dt">Address</span><span class="ot">=</span><span class="st">172.16.1.1/16</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>DHCP Server Configuration for Subnets</strong>
<ul>
<li>This configuration, creates a subnet (10.0.1.0/24) on eth1</li>
<li>Enables a DHCP server</li>
<li>Allocates IPs from 10.0.1.11 (base + offset of 10) through 10.0.1.210 (for 200 addresses)</li>
<li>Provides DNS server information to DHCP clients</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/systemd/network/25-dhcp-server.network</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">[Match]</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Name</span><span class="ot">=</span><span class="st">eth1</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[Network]</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="dt">Address</span><span class="ot">=</span><span class="st">10.0.1.1/24</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="dt">IPForward</span><span class="ot">=</span><span class="kw">yes</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="dt">DHCPServer</span><span class="ot">=</span><span class="kw">yes</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="kw">[DHCPServer]</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="dt">PoolOffset</span><span class="ot">=</span><span class="dv">10</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="dt">PoolSize</span><span class="ot">=</span><span class="dv">200</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="dt">EmitDNS</span><span class="ot">=</span><span class="kw">yes</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="dt">DNS</span><span class="ot">=</span><span class="st">8.8.8.8</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Although more complicated than simple networking, subnetting can enhance security when configured properly. It improves isolation by putting separate sensitive services onto different subnets, segmentation by limiting broadcast domains to reduce the potential attack surface, and access control by implementing filters between subnets at the router level. You can see an example of a security-enhanced subnet configuration below, as well as a list of commands to troubleshoot your subnet with.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode ini code-with-copy"><code class="sourceCode ini"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /etc/systemd/network/25-secure-subnet.network</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">[Match]</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="dt">Name</span><span class="ot">=</span><span class="st">eth2</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[Network]</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="dt">Address</span><span class="ot">=</span><span class="st">10.0.3.1/24</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="dt">IPForward</span><span class="ot">=</span><span class="kw">yes</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="dt">IPMasquerade</span><span class="ot">=</span><span class="st">yes  # NAT for outgoing connections</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="dt">ConfigureWithoutCarrier</span><span class="ot">=</span><span class="kw">yes</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="kw">[DHCPServer]</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="dt">PoolOffset</span><span class="ot">=</span><span class="dv">50</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="dt">PoolSize</span><span class="ot">=</span><span class="dv">100</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="dt">EmitDNS</span><span class="ot">=</span><span class="kw">yes</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="dt">DNS</span><span class="ot">=</span><span class="st">1.1.1.1</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Restrict routes between subnets for this segment</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="kw">[Route]</span></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="dt">Gateway</span><span class="ot">=</span><span class="st">_ipv4gateway</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="dt">Destination</span><span class="ot">=</span><span class="st">0.0.0.0/0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check interface configuration</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ip</span> addr show</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify routing tables</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ip</span> route show</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="ex">ip</span> route show table 200  <span class="co"># For custom route tables</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Test connectivity between subnets</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ping</span> 10.0.1.1  <span class="co"># From another subnet</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co"># View ARP table to verify proxy ARP functionality</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="ex">ip</span> neigh show</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Check systemd-networkd logs for issues</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="ex">journalctl</span> <span class="at">-u</span> systemd-networkd <span class="at">-n</span> 50</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="sec-ssh" class="level2">
<h2 class="anchored" data-anchor-id="sec-ssh">SSH</h2>
<p>Now that you have your basic Ubuntu Pi server configured and connected to a network, it’s time to do some final configurations before beginning the more coding focused development. For the coding side of things, we’ll want to remotely connect using a different computer and connection than the wired keyboard/monitor with our Raspberry Pi. To do this, we’ll utilize VS Code, an open source IDE (integrated development environment) from Microsoft. Before that, we’ll need to setup and configure SSH (Secure Shell), one of the most common ways to connect to a remote server. Simply put, SSH is a network protocol that creates an encrypted tunnel between computers, allowing secure remote management. Think of it as establishing a private, secure telephone line that only authorized parties can use to communicate.</p>
<p>Once we have SSH setup, configured, and secured, we’ll use a feature in VS Code called <code>Remote - SSH</code> which lets us use the nice UI of an IDE while working on the actual server. This is really beneficial for a variety of reasons: one of them being the fantastic community-built extensions that drastically improve the development experience, another being the integration with other tools for things like CI/CD.</p>
<section id="understanding-ssh-configuration-files" class="level3">
<h3 class="anchored" data-anchor-id="understanding-ssh-configuration-files">Understanding SSH Configuration Files</h3>
<section id="ssh-client-vs-server-configuration" class="level4">
<h4 class="anchored" data-anchor-id="ssh-client-vs-server-configuration">SSH Client vs Server Configuration</h4>
<p>The SSH system uses two main configuration files with distinct purposes:</p>
<ol type="1">
<li><code>ssh_config</code>:
<ul>
<li>Lives on your client machine (like your laptop)</li>
<li>Controls how your system behaves when connecting to other SSH servers</li>
<li>Affects outgoing SSH connections</li>
<li>Located at <code>/etc/ssh/ssh_config</code> (system-wide) and <code>~/.ssh/config</code> (user-specific)
<ul>
<li>If your server ever moves or connects to a new IP address, simply update it in the user config file</li>
</ul></li>
</ul></li>
<li><code>sshd_config</code>:
<ul>
<li>Lives on your server (the Raspberry Pi)</li>
<li>Controls how your SSH server accepts incoming connections</li>
<li>Determines who can connect and how</li>
<li>Located at <code>/etc/ssh/sshd_config</code></li>
<li>Requires root privileges to modify</li>
<li>Changes require restarting the SSH service</li>
</ul></li>
</ol>
</section>
</section>
<section id="key-based-authentication-setup" class="level3">
<h3 class="anchored" data-anchor-id="key-based-authentication-setup">Key-Based Authentication Setup</h3>
<section id="understanding-ssh-keys-and-security" class="level4">
<h4 class="anchored" data-anchor-id="understanding-ssh-keys-and-security">Understanding SSH Keys and Security</h4>
<p>This guide uses ECDSA-384 keys, which offer several advantages:</p>
<ul>
<li>Uses the NIST P-384 curve, providing security equivalent to 192-bit symmetric encryption</li>
<li>Better resistance to potential quantum computing attacks compared to smaller key sizes</li>
<li>Standardized under FIPS 186-4</li>
<li>Excellent balance between security and performance</li>
</ul>
</section>
<section id="generating-your-ssh-keys" class="level4">
<h4 class="anchored" data-anchor-id="generating-your-ssh-keys">Generating Your SSH Keys</h4>
<p>You might remember from the beginning of this guide that you can generate an SSH key-pair when flashing the image using RPi Imager. If you didn’t do that and want to learn how you can handle this all, the <em>old fashioned way</em>, then on your laptop, generate a new SSH key pair:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a new SSH key pair using ECDSA-384</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh-keygen</span> <span class="at">-t</span> ecdsa <span class="at">-b</span> 384 <span class="at">-C</span> <span class="st">"ubuntu-pi-server"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command:</p>
<ul>
<li><code>-t ecdsa</code>: Specifies the ECDSA algorithm</li>
<li><code>-b 384</code>: Sets the key size to 384 bits</li>
<li><code>-C "ubuntu-pi-server"</code>: Adds a descriptive comment</li>
</ul>
<p>The command generates two files:</p>
<ul>
<li><code>~/.ssh/id_ecdsa</code>: Your private key (keep this secret!)</li>
<li><code>~/.ssh/id_ecdsa.pub</code>: Your public key (safe to share)</li>
</ul>
</section>
<section id="installing-your-public-key-on-the-raspberry-pi" class="level4">
<h4 class="anchored" data-anchor-id="installing-your-public-key-on-the-raspberry-pi">Installing Your Public Key on the Raspberry Pi</h4>
<p>Transferring your public key to your Raspberry Pi is easy, just know the following will not work if you generated a key-pair when flashing the image. This only works if you currently have password authentication enabled.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ssh-copy-id</span> <span class="at">-i</span> ~/.ssh/id_ecdsa.pub chris@ubuntu-pi-server</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command:</p>
<ol type="1">
<li>Connects to your Pi using password authentication
<ol type="1">
<li>If you’re restoring your config, you’ll need to temporarily set <strong><em>PasswordAuthentication</em></strong> in <code>/etc/ssh/sshd_config</code> to yes</li>
</ol></li>
<li>Creates the <code>.ssh</code> directory if needed</li>
<li>Adds your public key to <code>authorized_keys</code></li>
<li>Sets appropriate permissions automatically</li>
</ol>
</section>
</section>
<section id="server-side-ssh-configuration" class="level3">
<h3 class="anchored" data-anchor-id="server-side-ssh-configuration">Server-Side SSH Configuration</h3>
<p>A client-server relationship is a fundamental computing model that underpins most network communications and distributed systems. This architecture divides computing responsibilities between service requestors (clients, your laptop in this case) and service providers (servers, the Raspberry Pi in this case).</p>
<p>A server is a computer program or device that provides functionality, resources, or services to multiple clients.</p>
<ul>
<li><strong>Service Provider:</strong> Responds to client requests rather than initiating communication</li>
<li><strong>Resource Management:</strong> Manages shared resources (files, databases, computational power)</li>
<li><strong>Continuous Operation:</strong> Typically runs continuously, waiting for client requests</li>
<li><strong>Scalability:</strong> Often designed to handle multiple concurrent client connections</li>
<li><strong>Examples:</strong> Web servers, database servers, file servers, mail servers, authentication servers</li>
</ul>
<p>Client-server communication follows a request-response pattern:</p>
<ul>
<li><strong>Connection:</strong> The client establishes a connection to the server</li>
<li><strong>Request:</strong> The client sends a formatted request for a specific service</li>
<li><strong>Processing:</strong> The server processes the request according to its business logic</li>
<li><strong>Response:</strong> The server returns appropriate data or status information</li>
<li><strong>Disconnection or Persistence:</strong> The connection may be terminated or maintained for future requests</li>
</ul>
<p>This communication typically occurs over TCP/IP networks using standardized protocols that define the format and sequence of messages exchanged.</p>
<section id="understanding-server-host-keys" class="level4">
<h4 class="anchored" data-anchor-id="understanding-server-host-keys">Understanding Server Host Keys</h4>
<p>Your Pi’s <code>/etc/ssh</code> directory contains several important files: - Host key pairs (public and private) for different algorithms - Configuration files and directories - The moduli file for key exchange</p>
</section>
<section id="optimizing-server-security" class="level4">
<h4 class="anchored" data-anchor-id="optimizing-server-security">Optimizing Server Security</h4>
<ol type="1">
<li>Back up the original configuration:</li>
</ol>
<div class="sourceCode" id="cb45"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cp /etc/ssh/sshd_config /etc/ssh/sshd_config.backup-<span class="va">$(</span><span class="fu">date</span> +%Y%m%d<span class="va">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>Optimize host key settings in sshd_config:</li>
</ol>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify host key order (prioritize ECDSA)</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="ex">HostKey</span> /etc/ssh/ssh_host_ecdsa_key</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="ex">HostKey</span> /etc/ssh/ssh_host_ed25519_key</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="ex">HostKey</span> /etc/ssh/ssh_host_rsa_key</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>Strengthen the moduli file:</li>
</ol>
<div class="sourceCode" id="cb47"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Back up the existing file</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> cp /etc/ssh/moduli /etc/ssh/moduli.backup</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove moduli less than 3072 bits</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> awk <span class="st">'$5 &gt;= 3072'</span> /etc/ssh/moduli <span class="op">&gt;</span> /tmp/moduli</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mv /tmp/moduli /etc/ssh/moduli</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li>Apply changes:</li>
</ol>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test the configuration</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> sshd <span class="at">-t</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Restart the SSH service (on Ubuntu Server)</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl restart ssh</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the service status</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl status ssh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Just note, you’ll probably need to reboot (<code>sudo reboot</code>) your server before all of the changes fully take place. Once you’ve done that, you may need to run <code>sudo systemctl start ssh</code>.</p>
</section>
</section>
<section id="client-side-configuration" class="level3">
<h3 class="anchored" data-anchor-id="client-side-configuration">Client-Side Configuration</h3>
<p>A client is a computer program or device that requests services, resources, or information from a server.</p>
<ul>
<li><strong>Request Initiator:</strong> Clients always initiate communication with servers</li>
<li><strong>User Interface:</strong> Often provides the interface through which users interact with remote services</li>
<li><strong>Limited Resources:</strong> Typically has fewer resources than servers and offloads intensive processing</li>
<li><strong>Dependency:</strong> Relies on servers to fulfill requests and cannot function independently for networked operations</li>
<li><strong>Examples:</strong> Web browsers, email clients, SSH clients, mobile applications</li>
</ul>
<p>From a technical perspective, clients:</p>
<ul>
<li>Formulate and send requests using specific protocols (HTTP, FTP, SMTP, etc.)</li>
<li>Wait for and process server responses</li>
<li>Present results to users or use them for further operations</li>
</ul>
<section id="setting-up-your-ssh-config" class="level4">
<h4 class="anchored" data-anchor-id="setting-up-your-ssh-config">Setting Up Your SSH Config</h4>
<p>Create or edit <code>~/.ssh/config</code> on your laptop:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="ex">Host</span> ubuntu-pi-server</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="ex">HostName</span> ubuntu-pi-server</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">User</span> chris</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">IdentityFile</span> ~/.ssh/id_ecdsa</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Port</span> 45000</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled" title="SSH Config: Include">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
SSH Config: Include
</div>
</div>
<div class="callout-body-container callout-body">
<p>If your ssh isn’t picking up on the ~/.ssh/ssh_config then you might need to specify it in the system config. Find the line in <code>/etc/ssh/ssh_config</code> that says <strong>Include</strong> and add the absolute file path. If you need to include more than your user specific config, such as the default <code>/etc/ssh/ssh_config.d/*</code> just add that absolute path separated by a space from any other path included.</p>
</div>
</div>
</section>
<section id="managing-known-hosts" class="level4">
<h4 class="anchored" data-anchor-id="managing-known-hosts">Managing Known Hosts</h4>
<ol type="1">
<li>Back up your current known_hosts file:</li>
</ol>
<div class="sourceCode" id="cb50"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cp</span> ~/.ssh/known_hosts ~/.ssh/known_hosts.backup</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>View current entries:</li>
</ol>
<div class="sourceCode" id="cb51"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh-keygen</span> <span class="at">-l</span> <span class="at">-f</span> ~/.ssh/known_hosts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>Remove old entries:</li>
</ol>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove specific host</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh-keygen</span> <span class="at">-R</span> ubuntu-pi-server</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="4" type="1">
<li>Hash your known_hosts file for security:</li>
</ol>
<div class="sourceCode" id="cb53"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh-keygen</span> <span class="at">-H</span> <span class="at">-f</span> ~/.ssh/known_hosts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="securing-the-key-file" class="level4">
<h4 class="anchored" data-anchor-id="securing-the-key-file">Securing the Key File</h4>
<p>When using SSH key-based authentication, adding a password to your key enhances security by requiring a passphrase to use the key. This guide explains how to add and remove a password from an existing SSH key.</p>
<p><strong>Adding a Password to an SSH Key</strong></p>
<p>If you already have an SSH key and want to add a password to it, use the following command:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode sh code-with-copy"><code class="sourceCode bash"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh-keygen</span> <span class="at">-p</span> <span class="at">-f</span> ~/.ssh/id_rsa</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Explanation:</p>
<pre><code>-p : Prompts for changing the passphrase.
-f ~/.ssh/id_rsa : Specifies the key file to modify (adjust if your key has a different name).
You will be asked for the current passphrase (leave blank if none) and then set a new passphrase.</code></pre>
<p><strong>Removing a Password from an SSH Key</strong></p>
<p>If you want to remove the passphrase from an SSH key, run:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh-keygen</span> <span class="at">-p</span> <span class="at">-f</span> ~/.ssh/id_rsa <span class="at">-N</span> <span class="st">""</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Explanation:</p>
<pre><code>-N "" : Sets an empty passphrase (removes the password).
The tool will ask for the current passphrase before removing it.</code></pre>
<p>Verifying the Changes</p>
<p>After modifying the key, test the SSH connection from your CLI, or using an SSH tunnel.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="at">-i</span> ~/.ssh/id_rsa user@your-server</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If you added a passphrase, you’ll be prompted to enter it when connecting.</p>
<p>By using a passphrase, your SSH key is protected against unauthorized use in case it gets compromised. If you frequently use your SSH key, consider using an SSH agent (ssh-agent) to cache your passphrase securely.</p>
</section>
</section>
<section id="additional-security-measures" class="level3">
<h3 class="anchored" data-anchor-id="additional-security-measures">Additional Security Measures</h3>
<p>Network security for a Linux server relies on multiple layers of protection. Two essential components are a properly configured firewall and intrusion prevention systems. This section covers UFW (Uncomplicated Firewall) and Fail2Ban, two powerful yet accessible tools for hardening your Ubuntu Pi Server.</p>
<section id="firewall-configuration-with-ufw" class="level4">
<h4 class="anchored" data-anchor-id="firewall-configuration-with-ufw">Firewall Configuration with ufw</h4>
<p>A firewall acts as a barrier between your server and potentially hostile networks by controlling incoming and outgoing traffic based on predetermined rules. UFW provides a user-friendly interface to the underlying iptables firewall system in Linux.</p>
<ul>
<li><strong>Default Deny Policy:</strong> Start with blocking all connections and only allow specific permitted traffic</li>
<li><strong>Stateful Inspection:</strong> Track the state of active connections rather than just examining individual packets</li>
<li><strong>Port Control:</strong> Allow or block access based on specific network ports</li>
<li><strong>Source Filtering:</strong> Control traffic based on originating IP addresses or networks</li>
</ul>
<div class="sourceCode" id="cb59"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install UFW (if it isn't already)</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install ufw</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Allow SSH connections</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw allow ssh</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Enable the firewall</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw enable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Behind the scenes, UFW translates these simple commands into complex iptables rules, making firewall management accessible without sacrificing security. The underlying iptables system uses a chain-based architecture to process packets through INPUT, OUTPUT, and FORWARD chains. Now, you’ll want to add rules for example, allowing traffic on a specific port if you took the step to choose a nonstandard, one that isn’t the default <strong>Port 22</strong>, for this guide, I’m choosing 45000.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a new rule in the port/protocol format</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw add 45000/tcp</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Allow traffic between subnets 10.0.1.0/24 and 10.0.2.0/24</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw allow from 10.0.1.0/24 to 10.0.2.0/24</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># See a list of all rules</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw status numbered</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the default rules</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> ufw delete 1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="fail2ban" class="level4">
<h4 class="anchored" data-anchor-id="fail2ban">Fail2Ban</h4>
<p>Fail2Ban is a security tool designed to protect servers from brute force attacks. It works by monitoring log files for specified patterns, identifying suspicious activity (like multiple failed login attempts), and banning the offending IP addresses using firewall rules for a set period. It’s especially useful for securing SSH, FTP, and web services.</p>
<p>The best part is the project is entirely open source, you can view the source code and contribute <a href="https://https://github.com/fail2ban/fail2ban">here</a>.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install Fail2Ban</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt install fail2ban</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Start and enable Fail2Ban</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl start fail2ban</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl enable fail2ban</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the status of all jails</span></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> fail2ban-client status</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the status of a specific jail</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> fail2ban-client status sshd</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="co"># View banned IPs</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> iptables <span class="at">-L</span> <span class="at">-n</span> <span class="kw">|</span> <span class="fu">grep</span> f2b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I want to add that <code>fail2ban</code> automatically pulls values for its jails depending on how you’ve configured things on your system, at least I assume so. I’m assuming that because I never configured specific ssh rules for fail2ban, but it knows to allow the port I set in my <code>sshd_config</code>. That being said, you can see how simple it was to setup these tools, and how they work together to create a comprehensive security system:</p>
<ul>
<li>UFW establishes the baseline by controlling which ports are accessible</li>
<li>Fail2Ban adds behavioral analysis by monitoring authentication attempts</li>
<li>Together they provide both static and dynamic protection</li>
</ul>
<p>This layered approach follows the defense-in-depth principle essential to modern cybersecurity. By combining a properly configured firewall with an intrusion prevention system, you significantly reduce the attack surface of your Ubuntu Pi Server.</p>
</section>
</section>
<section id="system-updates" class="level3">
<h3 class="anchored" data-anchor-id="system-updates">System Updates</h3>
<p>Keep your system updated:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> apt update <span class="kw">&amp;&amp;</span> <span class="fu">sudo</span> apt upgrade</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="monitoring-and-maintenance" class="level3">
<h3 class="anchored" data-anchor-id="monitoring-and-maintenance">Monitoring and Maintenance</h3>
<section id="regular-security-checks" class="level4">
<h4 class="anchored" data-anchor-id="regular-security-checks">Regular Security Checks</h4>
<ol type="1">
<li>Monitor SSH login attempts:</li>
</ol>
<div class="sourceCode" id="cb63"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> journalctl <span class="at">-u</span> ssh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>Check authentication logs:</li>
</ol>
<div class="sourceCode" id="cb64"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> tail <span class="at">-f</span> /var/log/auth.log</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="key-management-best-practices" class="level4">
<h4 class="anchored" data-anchor-id="key-management-best-practices">Key Management Best Practices</h4>
<ol type="1">
<li>Protect your private key:</li>
</ol>
<ul>
<li>Use a strong passphrase</li>
<li>Never share or copy to unsecured devices</li>
<li>Keep secure backups</li>
</ul>
<ol start="2" type="1">
<li>Verify file permissions:</li>
</ol>
<div class="sourceCode" id="cb65"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On your laptop</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 700 ~/.ssh</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 600 ~/.ssh/id_ecdsa</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 644 ~/.ssh/id_ecdsa.pub</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># On your Pi</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 700 ~/.ssh</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 600 ~/.ssh/authorized_keys</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="troubleshooting-1" class="level3">
<h3 class="anchored" data-anchor-id="troubleshooting-1">Troubleshooting</h3>
<p>If you can’t connect:</p>
<ol type="1">
<li>Verify SSH service status:</li>
</ol>
<div class="sourceCode" id="cb66"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl status ssh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>Check SSH connectivity:</li>
</ol>
<div class="sourceCode" id="cb67"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Test SSH connection verbosely</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="at">-v</span> chris@ubuntu-pi-server</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="3" type="1">
<li>Verify host key fingerprints:</li>
</ol>
<div class="sourceCode" id="cb68"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On the Pi</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh-keygen</span> <span class="at">-l</span> <span class="at">-f</span> /etc/ssh/ssh_host_ecdsa_key.pub</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Remember: When you see a host key verification prompt, always verify the fingerprint matches your server’s key before accepting.</p>
</section>
<section id="scp-secure-copy-protocol-and-rsync-remote-sync" class="level3">
<h3 class="anchored" data-anchor-id="scp-secure-copy-protocol-and-rsync-remote-sync">SCP (Secure Copy Protocol) and rsync (Remote Sync)</h3>
<p>This section outlines the process of securely copying files between your Ubuntu Pi Server and your Client machine. I’ll cover two powerful methods: SCP (Secure Copy Protocol) and rsync. Both tools operate over SSH, ensuring your file transfers remain encrypted and secure.</p>
<p><code>SCP</code> is a simple file transfer utility built on SSH that allows you to copy files between computers. It’s straightforward for basic transfers but lacks advanced features for large or frequent transfers.</p>
<p><code>rsync</code> is a more sophisticated file synchronization and transfer utility that offers several advantages over SCP:</p>
<ul>
<li><strong>Incremental transfers</strong>: Only sends parts of files that changed</li>
<li><strong>Resume capability</strong>: Can continue interrupted transfers</li>
<li><strong>Bandwidth control</strong>: Can limit how much network it uses</li>
<li><strong>Preservation options</strong>: Maintains file timestamps, permissions, etc.</li>
<li><strong>Directory synchronization</strong>: Can mirror directory structures</li>
<li><strong>Exclusion patterns</strong>: Can skip specified files/directories</li>
</ul>
<section id="ensuring-your-ssh-configuration-works" class="level4">
<h4 class="anchored" data-anchor-id="ensuring-your-ssh-configuration-works">Ensuring Your SSH Configuration Works</h4>
<p>Before attempting file transfers, verify your SSH connection is properly configured:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="at">-F</span> ~/.ssh/config chris@ubuntu-pi-server</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command explicitly specifies the user configuration file location with the <code>-F</code> flag.</p>
<p><strong>Note:</strong> To ensure SSH always uses your user-specific config:</p>
<ol type="1">
<li>Set proper permissions on your config file:</li>
</ol>
<div class="sourceCode" id="cb70"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> 600 ~/.ssh/config</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>Update the system-wide SSH config to include your user config:</li>
</ol>
<div class="sourceCode" id="cb71"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /etc/ssh/ssh_config</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Add this line:</p>
<pre class="plaintext"><code>Include ~/.ssh/config</code></pre>
<p>After applying these changes, you should be able to connect using the simplified command:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> ubuntu-pi-server</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="copying-individual-files-from-server-to-client" class="level4">
<h4 class="anchored" data-anchor-id="copying-individual-files-from-server-to-client">Copying Individual Files from Server to Client</h4>
<p>The basic syntax for copying files from your server to your local machine is shown below. Know that in all code examples in this section, you should run it in a terminal on your client/local machine:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> ubuntu-pi-server:~/configs/wpa_supplicant-wlan0.conf ~/Documents/raspberry_pi_server/configs</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> ubuntu-pi-server:~/configs/25-wireless.network ~/Documents/raspberry_pi_server/configs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Each command performs the following actions:</p>
<ul>
<li><code>scp</code>: Invokes the secure copy program</li>
<li><code>ubuntu-pi-server:~/configs/wpa_supplicant-wlan0.conf</code>: Specifies the source file on the remote server</li>
<li><code>~/Documents/raspberry_pi_server/25-wireless.network</code>: Specifies the destination directory on your local machine</li>
</ul>
</section>
<section id="copying-multiple-files-at-once" class="level4">
<h4 class="anchored" data-anchor-id="copying-multiple-files-at-once">Copying Multiple Files at Once</h4>
<p>To copy all Bash scripts from a directory in one command:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> chris@ubuntu-pi-server:~/configs/<span class="pp">*</span>.sh ~/Documents/raspberry_pi_server/configs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The wildcard pattern <code>*.sh</code> tells SCP to match all files with the <code>.sh</code> extension. Here, I’ve included the username <code>chris@</code> explicitly, which can help resolve connection issues if your SSH config isn’t being properly recognized.</p>
</section>
<section id="recursively-copying-directories" class="level4">
<h4 class="anchored" data-anchor-id="recursively-copying-directories">Recursively Copying Directories</h4>
<p>To copy entire directories with their contents:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="at">-r</span> chris@ubuntu-pi-server:~/mnt/backups/ ~/Documents/raspberry_pi_server/configsbackups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>-r</code> flag (recursive) tells SCP to copy directories and their contents.</p>
</section>
<section id="copying-files-from-client-to-server" class="level4">
<h4 class="anchored" data-anchor-id="copying-files-from-client-to-server">Copying Files from Client to Server</h4>
<p>To send files in the opposite direction (local to remote):</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scp</span> <span class="at">-r</span> ~/Documents/pi-scripts chris@ubuntu-pi-server:~/scripts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="transferring-files-with-rsync" class="level4">
<h4 class="anchored" data-anchor-id="transferring-files-with-rsync">Transferring Files with rsync</h4>
<p>For larger files or when you need to synchronize directories, rsync offers significant advantages over SCP.</p>
<p>To copy a single file from server to client:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> ubuntu-pi-server:~/configs/25-wireless.network ~/Documents/raspberry_pi_server/configs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Let’s break down these common flags: - <code>-a</code>: Archive mode, preserves permissions, timestamps, etc. (shorthand for <code>-rlptgoD</code>) - <code>-v</code>: Verbose, shows detailed progress - <code>-z</code>: Compresses data during transfer, saving bandwidth</p>
</section>
<section id="syncing-directories-with-rsync" class="level4">
<h4 class="anchored" data-anchor-id="syncing-directories-with-rsync">Syncing Directories with rsync</h4>
<p>To sync an entire directory from server to client:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> <span class="at">--progress</span> ubuntu-pi-server:~/configs/ ~/Documents/raspberry_pi_server/configs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>--progress</code> flag shows a progress bar for each file transfer, which is particularly useful for large files.</p>
<p><strong>Important Note</strong>: The trailing slash on the source path (<code>~/configs/</code>) is significant: - <strong>With trailing slash</strong>: Copies the contents of the directory - <strong>Without trailing slash</strong>: Copies the directory itself and its contents</p>
</section>
<section id="syncing-in-reverse-client-to-server" class="level4">
<h4 class="anchored" data-anchor-id="syncing-in-reverse-client-to-server">Syncing in Reverse (Client to Server)</h4>
<p>To sync files from your client to the server:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> <span class="at">--progress</span> ~/Documents/raspberry_pi_server/configs chris@ubuntu-pi-server:~/configs/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="using-rsync-with-dry-run" class="level4">
<h4 class="anchored" data-anchor-id="using-rsync-with-dry-run">Using rsync with Dry Run</h4>
<p>Before performing large transfers, you can see what would happen without actually making changes:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avzn</span> <span class="at">--progress</span> ~/Documents/raspberry_pi_server/configs chris@ubuntu-pi-server:~/configs/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>-n</code> flag (or <code>--dry-run</code>) simulates the transfer without changing any files, letting you verify what would happen.</p>
</section>
<section id="incremental-backups-with-rsync" class="level4">
<h4 class="anchored" data-anchor-id="incremental-backups-with-rsync">Incremental Backups with rsync</h4>
<p>rsync excels at keeping directories in sync over time. After the initial transfer, subsequent runs only transfer what’s changed:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> <span class="at">--delete</span> ~/Documents/raspberry_pi_server/configs chris@ubuntu-pi-server:~/configs/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>--delete</code> flag removes files from the destination that no longer exist in the source, creating a perfect mirror. Use with caution!</p>
</section>
<section id="advanced-rsync-examples" class="level4">
<h4 class="anchored" data-anchor-id="advanced-rsync-examples">Advanced rsync Examples</h4>
</section>
<section id="excluding-files-or-directories" class="level4">
<h4 class="anchored" data-anchor-id="excluding-files-or-directories">Excluding Files or Directories</h4>
<p>To skip certain files or directories during transfer:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> <span class="at">--exclude</span><span class="op">=</span><span class="st">"*.tmp"</span> <span class="at">--exclude</span><span class="op">=</span><span class="st">"node_modules"</span> ~/Documents/raspberry_pi_server/configs chris@ubuntu-pi-server:~/configs/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This command excludes all <code>.tmp</code> files and the <code>node_modules</code> directory.</p>
</section>
<section id="setting-bandwidth-limits" class="level4">
<h4 class="anchored" data-anchor-id="setting-bandwidth-limits">Setting Bandwidth Limits</h4>
<p>If you need to limit how much network bandwidth rsync uses:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> <span class="at">--bwlimit</span><span class="op">=</span>1000 ~/Documents/raspberry_pi_server/configs chris@ubuntu-pi-server:~/configs/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>--bwlimit=1000</code> restricts transfer speed to 1000 KB/s (approximately 1 MB/s).</p>
</section>
<section id="preserving-hard-links" class="level4">
<h4 class="anchored" data-anchor-id="preserving-hard-links">Preserving Hard Links</h4>
<p>When backing up systems that use hard links (like Time Machine or some backup solutions):</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avH</span> ~/Documents/raspberry_pi_server/configs chris@ubuntu-pi-server:~/configs/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>-H</code> flag preserves hard links, which can save significant space in backups.</p>
</section>
<section id="choosing-between-scp-and-rsync" class="level4">
<h4 class="anchored" data-anchor-id="choosing-between-scp-and-rsync">Choosing Between SCP and rsync</h4>
<p>Use <strong>SCP</strong> when: - You need a quick, one-time file transfer - You want a simple command with minimal options - The files are small and not changing frequently</p>
<p>Use <strong>rsync</strong> when: - You need to synchronize directories - You’re transferring large files that might get interrupted - You want to maintain exact mirrors of directory structures - You’re setting up automated backups - You need to preserve file attributes like permissions and timestamps - You need to exclude certain files or patterns</p>
<ul>
<li><strong>SSH Configuration</strong>: Ensure your SSH config is properly set up before attempting file transfers</li>
<li><strong>SCP</strong>: Simple, straightforward file copying between systems</li>
<li><strong>rsync</strong>: More powerful synchronization tool with many options for efficiency
<ul>
<li>SSH is now correctly configured and working using <code>ssh ubuntu-pi-server</code>.</li>
<li>Bash scripts can be securely copied from the Ubuntu Pi Server to the client machine using <code>scp</code>.
<ul>
<li>Just take note of the specific syntax used, namely <code>server-name:path/to/files</code></li>
</ul></li>
<li>The user can now maintain local backups of important scripts efficiently.
<ul>
<li>Enables you to develop where you’d like and then easily move files to test scripts</li>
</ul></li>
</ul></li>
<li><strong>Trailing Slashes</strong>: Pay attention to trailing slashes in paths, as they change behavior</li>
<li><strong>Dry Run</strong>: Use <code>--dry-run</code> with rsync to preview what will happen</li>
<li><strong>Automation</strong>: Consider creating scripts for routine backup tasks</li>
</ul>
<p>Both SCP and rsync are invaluable tools for managing files on your Raspberry Pi server. While SCP is perfect for quick, simple transfers, rsync provides the power and flexibility needed for maintaining backups and keeping systems synchronized.</p>
</section>
</section>
</section>
<section id="partitions" class="level2">
<h2 class="anchored" data-anchor-id="partitions">Partitions</h2>
<section id="partitioning-basics" class="level3">
<h3 class="anchored" data-anchor-id="partitioning-basics">Partitioning Basics</h3>
<p>Partitions are logical divisions of a physical storage device. Think of a storage device like a large piece of land, and partitions as fenced areas within that land dedicated to different purposes. Each partition appears to the operating system as a separate disk, even though physically they’re on the same device. Remember from the beginning of this guide, I’m using an SSD for my primary memory and a microSD card for backups.</p>
<ul>
<li><strong>Separation of concerns:</strong> Isolate the operating system from user data, which improves security and simplifies backups</li>
<li><strong>Performance optimization:</strong> Different filesystems can be used for different workloads</li>
<li><strong>Multi-boot capability:</strong> Install multiple operating systems on the same physical device</li>
<li><strong>Data protection:</strong> Limiting the scope of filesystem corruption to a single partition</li>
<li><strong>Resource management:</strong> Setting size limits for specific system functions</li>
</ul>
<p>For our Raspberry Pi server, proper partitioning creates a solid foundation for everything else you’ll build. We’ll primarily use ext4 for Linux partitions and FAT32 for the microSD card that needs broader compatibility.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 32%">
<col style="width: 51%">
</colgroup>
<thead>
<tr class="header">
<th>Filesystem</th>
<th>Best For</th>
<th>Features</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ext4</td>
<td>Linux</td>
<td><ul>
<li>Journaling</li>
<li>Large file support</li>
<li>Backwards compatible</li>
</ul></td>
</tr>
<tr class="even">
<td>FAT32</td>
<td>Cross-platform compatibility</td>
<td><ul>
<li>Works with virtually all operating systems</li>
<li>Limited to 4GB Files</li>
</ul></td>
</tr>
<tr class="odd">
<td>exFAT</td>
<td>Modern cross-platform</td>
<td><ul>
<li>Supports large files</li>
<li>No built-in journaling</li>
</ul></td>
</tr>
<tr class="even">
<td>NTFS</td>
<td>Windows compatibility</td>
<td><ul>
<li>Journaling</li>
<li>Permissions</li>
<li>Compression</li>
</ul></td>
</tr>
<tr class="odd">
<td>Btrfs</td>
<td>Advanced Linux systems</td>
<td><ul>
<li>Snapshots</li>
<li>Checksums</li>
<li>Compression</li>
</ul></td>
</tr>
</tbody>
</table>
<p>Finally, let’s cover some important terms:</p>
<ul>
<li><strong>Partition Table:</strong> A data structure on a disk that describes how the disk is divided
<ul>
<li><strong>MBR (Master Boot Record):</strong> Traditional partition scheme limited to 2TB drives and 4 primary partitions</li>
<li><strong>GPT (GUID Partition Table):</strong> Modern scheme supporting larger drives and more partitions</li>
</ul></li>
<li><strong>Partition Types:</strong>
<ul>
<li><strong>Primary:</strong> Can be bootable and hold an operating system</li>
<li><strong>Extended:</strong> Acts as a container for logical partitions (MBR only)</li>
<li><strong>Logical:</strong> Created within an extended partition (MBR only)</li>
</ul></li>
<li><strong>Filesystem:</strong> The method used to organize and store data within a partition
<ul>
<li><strong>Common Linux filesystems:</strong> <code>ext4</code>, <code>Btrfs</code></li>
<li><strong>Cross-platform filesystems:</strong> <code>FAT32</code>, <code>exFAT</code></li>
</ul></li>
</ul>
</section>
<section id="partitioning-tools" class="level3">
<h3 class="anchored" data-anchor-id="partitioning-tools">Partitioning Tools</h3>
<p>Several command-line tools are available for disk partitioning on Linux. Each has strengths for different scenarios:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 26%">
<col style="width: 35%">
<col style="width: 27%">
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Tool</strong></td>
<td><strong>Strengths</strong></td>
<td><strong>Limitations</strong></td>
<td><strong>Best For</strong></td>
</tr>
<tr class="even">
<td><code>fdisk</code></td>
<td><ul>
<li><p>Simple interface</p></li>
<li><p>Widely available</p></li>
</ul></td>
<td><ul>
<li>Limited GPT support in older versions</li>
</ul></td>
<td><ul>
<li>Basic partitioning tasks</li>
</ul></td>
</tr>
<tr class="odd">
<td><code>parted</code></td>
<td><ul>
<li><p>Full GPT support</p></li>
<li><p>Handles large drives</p></li>
</ul></td>
<td><ul>
<li>More complex syntax</li>
</ul></td>
<td><ul>
<li>Advanced partitioning needs</li>
</ul></td>
</tr>
<tr class="even">
<td><code>gdisk</code></td>
<td><ul>
<li><p>GPT focused</p></li>
<li><p>Similar to <code>fdisk</code></p></li>
</ul></td>
<td><ul>
<li>Less common on minimal installations</li>
</ul></td>
<td><ul>
<li>GPT-specific operations</li>
</ul></td>
</tr>
<tr class="odd">
<td><code>sfdisk</code></td>
<td><ul>
<li>Scriptable for automation</li>
</ul></td>
<td><ul>
<li>Less user-friendly</li>
</ul></td>
<td><ul>
<li>Automated deployments</li>
</ul></td>
</tr>
</tbody>
</table>
<p>For this project, and after doing some research, I chose parted for both the microSD card and SSD partitioning because:</p>
<ul>
<li>It fully supports both MBR and GPT partition tables</li>
<li>It can handle drives larger than 2TB (relevant for the SSD)</li>
<li>It provides a more consistent interface across different partition table types</li>
<li>It supports both interactive and command-line usage</li>
<li>It’s included in most Ubuntu installations</li>
</ul>
</section>
<section id="partitioning-a-microsd-card-for-backups" class="level3">
<h3 class="anchored" data-anchor-id="partitioning-a-microsd-card-for-backups">Partitioning a MicroSD Card for Backups</h3>
<p>Let’s partition our microSD card to serve as backup media. You can get great quality cards from Amazon Basics that are perfect for this use case. We’ll use a simple, effective partition scheme. Before we dive into the actual commands, it’s important to know that you can’t modify the memory of the active primary drive. Meaning, that you’ll need to use an SSD or thumbdrive as the boot media while you modify the SD card. Similarly, you’ll need to use a different piece of boot media (you could use the micro SD) when partitioning the SSD.</p>
<p>Now, let’s walk through this step-by-step:</p>
<ol type="1">
<li>Identify the device name of the microSD. Your microSD card will typically appear as something like /dev/mmcblk0 (what mine showed as) or /dev/sdX (where X is a letter like a, b, c). This command lists block devices with key information:</li>
</ol>
<div class="sourceCode" id="cb86"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> lsblk <span class="at">-o</span> NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>NAME:</strong> Device identifier</li>
<li><strong>SIZE:</strong> Storage capacity</li>
<li><strong>FSTYPE:</strong> Current filesystem type</li>
<li><strong>TYPE:</strong> Whether it’s a disk or partition</li>
<li><strong>MOUNTPOINT:</strong> Where it’s currently mounted (if applicable)</li>
</ul>
<ol start="2" type="1">
<li>For a backup microSD card, we’ll use a simple partition layout with a single partition using ext4 filesystem, which provides good performance and Linux compatibility.</li>
</ol>
<div class="sourceCode" id="cb87"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start parted on the microSD card (replace /dev/mmcblk0 with your device)</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> parted /dev/mmcblk0</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View the partition table for a specific device, or all</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="ex">print</span> mmcblk0</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a><span class="ex">print</span> all</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Inside parted, create a new GPT partition table</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">mklabel</span> gpt</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a><span class="ex">Warning:</span> The existing disk label on /dev/mmcblk0 will be destroyed and all data on this disk will be lost. Do you want to continue<span class="pp">?</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="ex">Yes/No?</span> Yes</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a single partition using the entire card</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">mkpart</span> primary ext4 0% 100%</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Set a name for easy identification</span></span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">name</span> 1 backups</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the partition layout</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">print</span></span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Exit parted</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> <span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">quit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>mklabel gpt</code>: Creates a new GPT partition table (preferred over MBR for modern systems)</li>
<li><code>mkpart primary ext4 0% 100%</code>: Creates a primary partition using the ext4 filesystem that spans the entire device</li>
<li><code>name 1 backup</code>: Names the first partition “backup” for easy identification</li>
<li><code>print</code>: Shows the current partition layout</li>
<li><code>quit</code>: Exits the parted utility</li>
</ul>
<ol start="3" type="1">
<li>After creating the partition, we need to format it with the ext4 filesystem. Double check the current layout of memory on your system with <code>sudo lsblk -o NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</code> before formatting the filesystem, to get the specific SD Card partitions device name:</li>
</ol>
<div class="sourceCode" id="cb88"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the partition (adjust if your device/partition is different)</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkfs.ext4 <span class="at">-L</span> backups /dev/mmcblk0p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>-L backup</code>: Sets the filesystem label to “backup”</li>
<li><code>/dev/mmcblk0p1</code>: The partition we just created (p1 indicates the first partition)</li>
<li>You’ll see an output similar to this:</li>
</ul>
<p><img src="images/parted-format-success.png" class="img-fluid"></p>
<ol type="1">
<li>Now, we need to prepare the SD card for backups. You can make those changes with the following commands:</li>
</ol>
<div class="sourceCode" id="cb89"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a mount point</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /mnt/backups</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add an entry to /etc/fstab for automatic mounting</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"UUID=</span><span class="va">$(</span><span class="fu">sudo</span> blkid <span class="at">-s</span> UUID <span class="at">-o</span> value /dev/mmcblk0p1<span class="va">)</span><span class="st"> /mnt/backups ext4 defaults,noatime 0 2"</span> <span class="kw">|</span> <span class="fu">sudo</span> tee <span class="at">-a</span> /etc/fstab</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Restart the systemd daemon to get the changes made to fstab</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> systemctl daemon-reload</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Mount the filesystem from fstab</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mount /dev/mmcblk0</span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create backup directories</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /mnt/backups/<span class="dt">{configs</span><span class="op">,</span><span class="dt">logs}</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-16"><a href="#cb89-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Set ownership (replace 'chris' with your username)</span></span>
<span id="cb89-17"><a href="#cb89-17" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> chris:chris /mnt/backups/</span>
<span id="cb89-18"><a href="#cb89-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-19"><a href="#cb89-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Set secure permissions</span></span>
<span id="cb89-20"><a href="#cb89-20" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chmod <span class="at">-R</span> 700 /mnt/backups/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>mkdir -p</code>: Creates directories and parent directories if they don’t exist</li>
<li><code>blkid -s UUID -o value</code>: Gets the UUID (unique identifier) of the partition</li>
<li><code>defaults,noatime</code>: Mount options for good performance (noatime disables recording access times)</li>
<li><code>0 2</code>: The fifth field (0) disables dumping, the sixth field (2) enables filesystem checks</li>
<li><code>mount -a</code>: Mounts all filesystems specified in fstab</li>
<li><code>chmod -R 700</code>: Sets permissions so only the owner can read/write/execute</li>
</ul>
</section>
<section id="partitioning-your-ssd" class="level3">
<h3 class="anchored" data-anchor-id="partitioning-your-ssd">Partitioning your SSD</h3>
<ol type="1">
<li>For the Samsung T7 SSD, we’ll follow a similar workflow, but we’ll create a more sophisticated partition scheme to support different use cases. The Samsung T7 SSD will likely appear as <code>/dev/sdX</code> (where X is a letter like a, b, c), mine is <code>/dev/sdb</code>.</li>
</ol>
<div class="sourceCode" id="cb90"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> lsblk <span class="at">-o</span> NAME,SIZE,FSTYPE,TYPE,MOUNTPOINT</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol start="2" type="1">
<li>For flexibility, we’ll create the following partitions:</li>
</ol>
<ul>
<li>A small <code>EFI System Partition</code> for UEFI boot compatibility</li>
<li>A <code>root partition</code> for the Ubuntu OS</li>
<li>A <code>swap partition</code>, a dedicated section of your hard drive used as virtual memory when your computer’s RAM (Random Access Memory) fills up</li>
<li>A <code>data partition</code> for general storage</li>
</ul>
<div class="sourceCode" id="cb91"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Start parted on the SSD (replace /dev/sda with your device)</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> parted /dev/sdb</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new GPT partition table</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">mklabel</span> gpt</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the EFI System Partition (ESP)</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">mkpart</span> primary fat32 1MiB 513MiB</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">name</span> 1 ESP</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="bu">set</span> 1 esp on</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the root partition</span></span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">mkpart</span> primary ext4 513MiB 100GiB</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">name</span> 2 ubuntu-root</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a swap partition (adjust size based on your RAM)</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">mkpart</span> swap linux-swap 100GiB 108GiB</span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data partition using the remaining space</span></span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">mkpart</span> data ext4 108GiB 100%</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the partition layout</span></span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">print</span></span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Exit parted</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">quit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>mkpart primary fat32 1MiB 513MiB</code>: Creates a 512MiB FAT32 partition starting at 1MiB</li>
<li><code>set 1 esp on</code>: Sets the ESP flag on the first partition</li>
<li>The sizes (100GiB, 108GiB) are specific positions on the disk, not partition sizes</li>
<li>Using MiB and GiB ensures proper alignment for better performance</li>
</ul>
<ol start="3" type="1">
<li>Now we need to format each partition.</li>
</ol>
<div class="sourceCode" id="cb92"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the ESP partition</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkfs.fat <span class="at">-F32</span> <span class="at">-n</span> ESP /dev/sdb1</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the root partition</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkfs.ext4 <span class="at">-L</span> ubuntu-root /dev/sdb2</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the swap space</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkswap <span class="at">-L</span> swap /dev/sdb3</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Format the data partition</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkfs.ext4 <span class="at">-L</span> data /dev/sdb4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>mkfs.fat -F32</code>: Creates a FAT32 filesystem</li>
<li><code>-n ESP</code>: Sets the volume label to “ESP”</li>
<li><code>mkfs.ext4</code>: Creates an ext4 filesystem</li>
<li><code>-L ubuntu-root</code>: Sets the filesystem label</li>
<li><code>mkswap</code>: Initializes a swap area</li>
<li><code>/dev/sdb1, /dev/sdb2, etc.</code>: The specific partitions we created</li>
</ul>
<ol start="4" type="1">
<li>Now we’ll need to mount the partitions by setting up mount points and telling the system to use them.</li>
</ol>
<div class="sourceCode" id="cb93"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Activate the swap</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> swapon /dev/sdb3</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create mount points</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /mnt/data</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add entries to /etc/fstab (using UUIDs for reliability)</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"UUID=</span><span class="va">$(</span><span class="fu">sudo</span> blkid <span class="at">-s</span> UUID <span class="at">-o</span> value /dev/sdb2<span class="va">)</span><span class="st"> / ext4 defaults,noatime 0 1"</span> <span class="kw">|</span> <span class="fu">sudo</span> tee <span class="at">-a</span> /etc/fstab</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"UUID=</span><span class="va">$(</span><span class="fu">sudo</span> blkid <span class="at">-s</span> UUID <span class="at">-o</span> value /dev/sdb1<span class="va">)</span><span class="st"> /boot/efi vfat defaults 0 2"</span> <span class="kw">|</span> <span class="fu">sudo</span> tee <span class="at">-a</span> /etc/fstab</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"UUID=</span><span class="va">$(</span><span class="fu">sudo</span> blkid <span class="at">-s</span> UUID <span class="at">-o</span> value /dev/sdb3<span class="va">)</span><span class="st"> none swap sw 0 0"</span> <span class="kw">|</span> <span class="fu">sudo</span> tee <span class="at">-a</span> /etc/fstab</span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"UUID=</span><span class="va">$(</span><span class="fu">sudo</span> blkid <span class="at">-s</span> UUID <span class="at">-o</span> value /dev/sdb4<span class="va">)</span><span class="st"> /mnt/data ext4 defaults,noatime 0 2"</span> <span class="kw">|</span> <span class="fu">sudo</span> tee <span class="at">-a</span> /etc/fstab</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Mount all filesystems </span><span class="al">TBD</span><span class="co"> ON THIS</span></span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mount <span class="at">-a</span> !!</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>swapon</code>: Activates the swap partition</li>
<li><code>defaults,noatime</code>: Standard mount options with access time recording disabled for better performance</li>
<li><code>0 1</code>: For the root partition, enabling filesystem checks with high priority</li>
<li><code>sw</code>: Indicates swap space</li>
<li>The different numbers at the end indicate filesystem check priority (0 = no check, 1 = highest priority)</li>
</ul>
<section id="advanced-partitioning" class="level4">
<h4 class="anchored" data-anchor-id="advanced-partitioning">Advanced Partitioning</h4>
<p>As you begin to utilize your server more, you’re bound to use up more memory. So, it’s important to monitor your partition space usage.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View disk usage</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="fu">df</span> <span class="at">-h</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View inode usage (for number of files)</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a><span class="fu">df</span> <span class="at">-i</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View detailed filesystem information</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> tune2fs <span class="at">-l</span> /dev/sda2 <span class="kw">|</span> <span class="fu">grep</span> <span class="at">-E</span> <span class="st">'Block count|Block size|Inode count|Inode size'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>df -h</code>: Shows disk usage in human-readable format</li>
<li><code>df -i</code>: Shows inode usage (inode = index node, representing a file)</li>
<li><code>tune2fs -l</code>: Lists filesystem information for ext2/3/4 filesystems</li>
<li><code>grep -E</code>: Filters output for specified patterns</li>
</ul>
<p>Furthermore, you may realize that you want to reformat your SSD at some point because your storage needs changed. You can reformat the partitions using the following code.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For online resizing of ext4 (unmounting not required)</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> parted /dev/sda</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">resizepart</span> 4 100%  <span class="co"># Resize partition 4 to use all available space</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">quit</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a><span class="co"># After resizing the partition, expand the filesystem</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> resize2fs /dev/sda4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>resizepart 4 100%</code>: Resizes partition 4 to use 100% of the remaining available space</li>
<li><code>resize2fs</code>: Resizes an ext2/3/4 filesystem to match the partition size</li>
</ul>
</section>
</section>
</section>
<section id="backups-and-basic-automation" class="level2">
<h2 class="anchored" data-anchor-id="backups-and-basic-automation">Backups and Basic Automation</h2>
<p>Now that we’ve configured the basics, from permissions to networking and ssh to partitions, we’ll want to save those changes in case something happens. You’ve already seen some basic backups. The process is the same, essentially creating a folder and then putting a copy of the current file into it and maybe adding a <code>.bak</code> extension to make it clear this is a previous version. That being said, to go through and do this for each and every folder we’ve made changes in is impractical now, let alone in the future when more complex configurations are done. So, in this section, we’ll go over creating a basic script to backup all of our configs and automating the backups.</p>
<p>For this section, we’ll use <code>rsync</code> because it provides several important advantages over simple copy commands, that you may remember from the section on <code>ssh</code>:</p>
<ul>
<li>Incremental backups that only transfer changed files</li>
<li>Preservation of file permissions, ownership, and timestamps</li>
<li>Built-in compression for efficient transfers</li>
<li>Detailed progress information and logging</li>
<li>The ability to resume interrupted transfers</li>
</ul>
<p>Before we start, make sure you have:</p>
<ul>
<li>A mounted backup drive at <code>/mnt/backups/</code></li>
</ul>
<section id="setting-up-the-backup-directory" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-backup-directory">Setting Up the Backup Directory</h3>
<p>First, we’ll prepare the backup directory structure and set appropriate permissions:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create backup directories if they don't exist</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /mnt/backups/configs</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> mkdir <span class="at">-p</span> /mnt/backups/system</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Change ownership to your user (replace 'chris' with your username)</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> chris:chris /mnt/backups</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Set appropriate permissions</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chmod <span class="at">-R</span> 700 /mnt/backups  <span class="co"># Only owner can read/write/execute</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="configuration-files-backup" class="level3">
<h3 class="anchored" data-anchor-id="configuration-files-backup">Configuration Files Backup</h3>
<p>We’ll use rsync to create a structured backup of essential configuration files. The following script demonstrates how to perform the backup while preserving all file attributes:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the {} around DATEYMD in the file path ensure it's specified as the variable's value, and the subsequent parts are not included</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="va">DATEYMD</span><span class="op">=</span><span class="va">$(</span><span class="fu">date</span> +%Y%m%d<span class="va">)</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="va">BACKUP_DIR</span><span class="op">=</span><span class="st">"/mnt/backups/configs/</span><span class="va">$DATEYMD</span><span class="st">"</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a><span class="va">LOG_DIR</span><span class="op">=</span><span class="st">"/mnt/backups/logs"</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="va">LOG_FILE</span><span class="op">=</span><span class="st">"</span><span class="va">$LOG_DIR</span><span class="st">/</span><span class="va">${DATEYMD}</span><span class="st">_config_backup.log"</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create backup directory</span></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">"</span></span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 1. User and Group Information</span></span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/passwd <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/passwd.bak"</span></span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/group <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/group.bak"</span></span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/shadow <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/shadow.bak"</span></span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/gshadow <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/gshadow.bak"</span></span>
<span id="cb97-18"><a href="#cb97-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-19"><a href="#cb97-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. Crontab Configurations</span></span>
<span id="cb97-20"><a href="#cb97-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/crontab <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/"</span></span>
<span id="cb97-21"><a href="#cb97-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /var/spool/cron/crontabs/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/crontabs/"</span></span>
<span id="cb97-22"><a href="#cb97-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-23"><a href="#cb97-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 3. SSH Configuration</span></span>
<span id="cb97-24"><a href="#cb97-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/ssh/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/ssh/"</span></span>
<span id="cb97-25"><a href="#cb97-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> ~/.ssh/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/user_ssh/"</span></span>
<span id="cb97-26"><a href="#cb97-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-27"><a href="#cb97-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 4. UFW (Uncomplicated Firewall) Configuration</span></span>
<span id="cb97-28"><a href="#cb97-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/ufw/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/ufw/"</span></span>
<span id="cb97-29"><a href="#cb97-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> ufw status verbose <span class="op">&gt;</span> <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/ufw_rules.txt"</span></span>
<span id="cb97-30"><a href="#cb97-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-31"><a href="#cb97-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 5. Fail2Ban Configuration</span></span>
<span id="cb97-32"><a href="#cb97-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/fail2ban/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/fail2ban/"</span></span>
<span id="cb97-33"><a href="#cb97-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-34"><a href="#cb97-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 6. Network Configuration</span></span>
<span id="cb97-35"><a href="#cb97-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/network/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/network/"</span></span>
<span id="cb97-36"><a href="#cb97-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/netplan/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/netplan/"</span></span>
<span id="cb97-37"><a href="#cb97-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/NetworkManager/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/NetworkManager/"</span></span>
<span id="cb97-38"><a href="#cb97-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/hosts <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/hosts.bak"</span></span>
<span id="cb97-39"><a href="#cb97-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/hostname <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/hostname.bak"</span></span>
<span id="cb97-40"><a href="#cb97-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/resolv.conf <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/resolv.conf.bak"</span></span>
<span id="cb97-41"><a href="#cb97-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/wpa_supplicant/wpa_supplicant.conf <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/wpa_supplicant.conf.bak"</span></span>
<span id="cb97-42"><a href="#cb97-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-43"><a href="#cb97-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 7. Package Manager Configurations (apt)</span></span>
<span id="cb97-44"><a href="#cb97-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/apt/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/apt/"</span></span>
<span id="cb97-45"><a href="#cb97-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-46"><a href="#cb97-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 8. Systemd Services and Timers</span></span>
<span id="cb97-47"><a href="#cb97-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/systemd/system/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/systemd/"</span></span>
<span id="cb97-48"><a href="#cb97-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-49"><a href="#cb97-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 9. Logrotate Configuration</span></span>
<span id="cb97-50"><a href="#cb97-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/logrotate.conf <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/logrotate.conf.bak"</span></span>
<span id="cb97-51"><a href="#cb97-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/logrotate.d/. <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/logrotate.d/"</span></span>
<span id="cb97-52"><a href="#cb97-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-53"><a href="#cb97-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 10. Timezone and Locale</span></span>
<span id="cb97-54"><a href="#cb97-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/timezone <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/timezone.bak"</span></span>
<span id="cb97-55"><a href="#cb97-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/localtime <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/localtime.bak"</span></span>
<span id="cb97-56"><a href="#cb97-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/default/locale <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/locale.bak"</span></span>
<span id="cb97-57"><a href="#cb97-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-58"><a href="#cb97-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 11. Keyboard Configuration</span></span>
<span id="cb97-59"><a href="#cb97-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> /etc/default/keyboard <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/keyboard.bak"</span></span>
<span id="cb97-60"><a href="#cb97-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-61"><a href="#cb97-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 12. Package List</span></span>
<span id="cb97-62"><a href="#cb97-62" aria-hidden="true" tabindex="-1"></a>    <span class="ex">dpkg</span> <span class="at">--get-selections</span> <span class="op">&gt;</span> <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/package_list.txt"</span></span>
<span id="cb97-63"><a href="#cb97-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-64"><a href="#cb97-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set appropriate permissions</span></span>
<span id="cb97-65"><a href="#cb97-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> chown <span class="at">-R</span> chris:chris <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">"</span></span>
<span id="cb97-66"><a href="#cb97-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> chmod <span class="at">-R</span> 600 <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">"</span></span>
<span id="cb97-67"><a href="#cb97-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-68"><a href="#cb97-68" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Configuration backup completed at: </span><span class="va">$BACKUP_DIR</span><span class="st">"</span></span>
<span id="cb97-69"><a href="#cb97-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-70"><a href="#cb97-70" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span> <span class="op">&gt;</span> <span class="st">"</span><span class="va">$LOG_FILE</span><span class="st">"</span> <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span></span>
<span id="cb97-71"><a href="#cb97-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-72"><a href="#cb97-72" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Logs available at: </span><span class="va">$LOG_FILE</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb98"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the script executable</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x /scripts/config_backup.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="system-files-backup" class="level3">
<h3 class="anchored" data-anchor-id="system-files-backup">System Files Backup</h3>
<p>For system files, we’ll create a separate rsync script that handles system directories efficiently:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="va">DATEYMD</span><span class="op">=</span><span class="va">$(</span><span class="fu">date</span> +%Y%m%d<span class="va">)</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="va">BACKUP_DIR</span><span class="op">=</span><span class="st">"/mnt/backups/system/</span><span class="va">$DATEYMD</span><span class="st">"</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="va">LOG_DIR</span><span class="op">=</span><span class="st">"/mnt/backups/logs"</span></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="va">LOG_FILE</span><span class="op">=</span><span class="st">"</span><span class="va">$LOG_DIR</span><span class="st">/</span><span class="va">${DATEYMD}</span><span class="st">_system_backup.log"</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create backup directory</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">"</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Starting script</span></span>
<span id="cb99-15"><a href="#cb99-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Starting system backup at: </span><span class="va">$(</span><span class="fu">date</span><span class="va">)</span><span class="st">"</span></span>
<span id="cb99-16"><a href="#cb99-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Backup directory: </span><span class="va">$BACKUP_DIR</span><span class="st">"</span></span>
<span id="cb99-17"><a href="#cb99-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-18"><a href="#cb99-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The --one-file-system option prevents crossing filesystem boundaries</span></span>
<span id="cb99-19"><a href="#cb99-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --hard-links preserves hard links</span></span>
<span id="cb99-20"><a href="#cb99-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --acls and --xattrs preserve extended attributes</span></span>
<span id="cb99-21"><a href="#cb99-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> rsync <span class="at">-aAXv</span> <span class="at">--one-file-system</span> <span class="at">--hard-links</span> <span class="dt">\</span></span>
<span id="cb99-22"><a href="#cb99-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">--exclude</span><span class="op">=</span><span class="st">"/mnt/"</span> <span class="dt">\</span></span>
<span id="cb99-23"><a href="#cb99-23" aria-hidden="true" tabindex="-1"></a>        / <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">"</span></span>
<span id="cb99-24"><a href="#cb99-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-25"><a href="#cb99-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 2. System Information Files</span></span>
<span id="cb99-26"><a href="#cb99-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Partition layout</span></span>
<span id="cb99-27"><a href="#cb99-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> fdisk <span class="at">-l</span> <span class="op">&gt;</span> <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/partition_layout.txt"</span></span>
<span id="cb99-28"><a href="#cb99-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Disk UUIDs</span></span>
<span id="cb99-29"><a href="#cb99-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> blkid <span class="op">&gt;</span> <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">/disk_uuids.txt"</span></span>
<span id="cb99-30"><a href="#cb99-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-31"><a href="#cb99-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set appropriate permissions</span></span>
<span id="cb99-32"><a href="#cb99-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> chown <span class="at">-R</span> chris:chris <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">"</span></span>
<span id="cb99-33"><a href="#cb99-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sudo</span> chmod <span class="at">-R</span> 600 <span class="st">"</span><span class="va">$BACKUP_DIR</span><span class="st">"</span></span>
<span id="cb99-34"><a href="#cb99-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-35"><a href="#cb99-35" aria-hidden="true" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"System backup completed at: </span><span class="va">$BACKUP_DIR</span><span class="st">."</span></span>
<span id="cb99-36"><a href="#cb99-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-37"><a href="#cb99-37" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span> <span class="op">&gt;</span> <span class="st">"</span><span class="va">$LOG_FILE</span><span class="st">"</span> <span class="dv">2</span><span class="op">&gt;&amp;</span><span class="dv">1</span></span>
<span id="cb99-38"><a href="#cb99-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-39"><a href="#cb99-39" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Logs available at: </span><span class="va">$LOG_FILE</span><span class="st">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb100"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the script executable</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x /scripts/system_backup.sh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="understanding-the-rsync-options" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-rsync-options">Understanding the rsync Options</h3>
<p>The rsync commands use several important options:</p>
<ul>
<li><code>-a</code>: Archive mode, preserves almost everything</li>
<li><code>-A</code>: Preserve ACLs (Access Control Lists)</li>
<li><code>-X</code>: Preserve extended attributes</li>
<li><code>-v</code>: Verbose output</li>
<li><code>--one-file-system</code>: Don’t cross filesystem boundaries</li>
<li><code>--hard-links</code>: Preserve hard links</li>
<li><code>--exclude</code>: Skip specified directories</li>
</ul>
</section>
<section id="storing-your-backups-externally" class="level3">
<h3 class="anchored" data-anchor-id="storing-your-backups-externally">Storing your backups externally</h3>
<p>While it’s definitely beneficial to have a local copy of your backups to easily roll back changes, it isn’t the most secure solution to have all of your information in one place. So, how can you go about transferring your system and configuration backups to another storage system?</p>
<p>For the purpose of this guide, I’ll be showing you how to use <code>rsync</code> for a remote transfer and how to flash the backup onto a <code>microSD</code>.</p>
<section id="rsync-for-remote-transfers" class="level4">
<h4 class="anchored" data-anchor-id="rsync-for-remote-transfers">Rsync for Remote Transfers</h4>
<p>Rsync is specifically designed for copying and transferring files, so it offers more sophisticated file synchronization capabilities than basic tools like SCP.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-avz</span> <span class="at">--partial</span> <span class="at">--progress</span> <span class="at">--update</span> chris@ubuntu-pi-server:/mnt/backups/system/master/ ~/Documents/raspberry_pi_server/backups/system/master</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The flags do the following:</p>
<ul>
<li><code>-a</code>: Archive mode, which preserves permissions, timestamps, symbolic links, etc.</li>
<li><code>-v</code>: Verbose output, showing what files are being transferred</li>
<li><code>-z</code>: Compress data during transfer for faster transmission</li>
<li><code>--partial</code>: Keep partially transferred files, allowing you to resume interrupted transfers</li>
<li><code>--progress</code>: Show progress during transfer</li>
<li><code>--update</code>: Skip files that are newer on the receiver (only transfer if source is newer)</li>
</ul>
</section>
<section id="hardware-transfers" class="level4">
<h4 class="anchored" data-anchor-id="hardware-transfers">Hardware Transfers</h4>
</section>
</section>
<section id="note" class="level3">
<h3 class="anchored" data-anchor-id="note"><strong>Note:</strong></h3>
<p><strong>Everything up until this point has been tested and works– relatively efficiently for such a simple setup. That being said, I still haven’t tested the restore script, nor have I tried to setup simple cron jobs to automate and cleanup the backups.</strong></p>
</section>
<section id="restoring-from-backup" class="level3">
<h3 class="anchored" data-anchor-id="restoring-from-backup">Restoring from Backup</h3>
<p>To restore your system from these backups:</p>
</section>
<section id="important-notes" class="level3">
<h3 class="anchored" data-anchor-id="important-notes">Important Notes</h3>
<ol type="1">
<li>The <code>--delete</code> option during restore will remove files at the destination that don’t exist in the backup. Use with caution.</li>
<li>Consider using rsync’s <code>--dry-run</code> option to test backups and restores without making changes.</li>
<li>The backup includes sensitive system files. Store it securely and restrict access.</li>
<li>Consider encrypting the backup directory for additional security.</li>
<li>Test the restore process in a safe environment before using in production.</li>
</ol>
</section>
<section id="automating-the-backup" class="level3">
<h3 class="anchored" data-anchor-id="automating-the-backup">Automating the Backup</h3>
<p>Create a master backup script that runs both configuration and system backups:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create master backup script (save as master-backup.sh)</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;&lt; 'EOF'</span> <span class="op">&gt;</span> /mnt/backups/master-backup.sh</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="st">#!/bin/bash</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="st"># Set up logging</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="st">exec 1&gt; &gt;(logger -s -t $(basename $0)) 2&gt;&amp;1</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a><span class="st"># Run configuration backup</span></span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a><span class="st">/mnt/backup/backup-configs.sh</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="st"># Run system backup</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a><span class="st">/mnt/backup/backup-system.sh</span></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a><span class="st"># Remove backups older than 30 days</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a><span class="st">find /mnt/backups/configs/ -type d -mtime +30 -exec rm -rf {} +</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a><span class="st">find /mnt/backups/system/ -type d -mtime +30 -exec rm -rf {} +</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the script executable</span></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a><span class="fu">chmod</span> +x /mnt/backup/master-backup.sh</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Add to crontab (run daily at 2 AM)</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="fu">crontab</span> <span class="at">-l</span> <span class="dv">2</span><span class="op">&gt;</span>/dev/null<span class="kw">;</span> <span class="bu">echo</span> <span class="st">"0 2 * * * /mnt/backup/master-backup.sh"</span><span class="kw">)</span> <span class="kw">|</span> <span class="fu">crontab</span> <span class="at">-</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="troubleshooting-2" class="level3">
<h3 class="anchored" data-anchor-id="troubleshooting-2">Troubleshooting</h3>
<p>If you encounter issues:</p>
<ol type="1">
<li>Check rsync error messages with <code>--verbose</code> option</li>
<li>Verify sufficient disk space with <code>df -h</code></li>
<li>Monitor backup progress with <code>--progress</code> option</li>
<li>Check system logs: <code>sudo journalctl -u cron</code></li>
<li>Verify file permissions and ownership</li>
<li>Test network connectivity for remote backups</li>
</ol>
<p>Remember to regularly verify your backups by checking the log files and occasionally testing the restore process in a safe environment.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://www.github.com/ChrisKornaros">
<p>GitHub</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/chris-kornaros">
<p>LinkedIn</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://bsky.app/profile/chriskornaros.bsky.social">
<p>Bluesky</p>
</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://forms.gle/gDEjGD9G6VkaxkWX6">
<p>Email</p>
</a>
  </li>  
</ul>
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ChrisKornaros/ChrisKornaros.github.io/blob/main/pages/projects/data_engineering/posts/raspberry_pi_server.qmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/ChrisKornaros/ChrisKornaros.github.io/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>